<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <meta name="referrer" content="no-referrer">
        <title>Unixæ–‡ä»¶IO - Weiyee&#39;s Blog</title><meta name="Description" content="è®°å½•ä¸ªäººå­¦ä¹ çš„åšå®¢"><meta property="og:title" content="Unixæ–‡ä»¶IO" />
<meta property="og:description" content="æœ¬æ–‡ä»‹ç»æ–‡ä»¶IOä¸æ ‡å‡†IOçš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶IOå‡½æ•° åŸºæœ¬æ¦‚å¿µ æ–‡ä»¶I/Oï¼šæ–‡ä»¶I/Oç§°ä¹‹ä¸ºä¸å¸¦ç¼“å­˜çš„IOï¼ˆunbuffered I/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://swjtulwy.github.io/fileio/" /><meta property="og:image" content="https://swjtulwy.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-08T11:14:22+08:00" />
<meta property="article:modified_time" content="2021-04-08T11:14:22+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://swjtulwy.github.io/logo.png"/>

<meta name="twitter:title" content="Unixæ–‡ä»¶IO"/>
<meta name="twitter:description" content="æœ¬æ–‡ä»‹ç»æ–‡ä»¶IOä¸æ ‡å‡†IOçš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶IOå‡½æ•° åŸºæœ¬æ¦‚å¿µ æ–‡ä»¶I/Oï¼šæ–‡ä»¶I/Oç§°ä¹‹ä¸ºä¸å¸¦ç¼“å­˜çš„IOï¼ˆunbuffered I/"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/blogging.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://swjtulwy.github.io/fileio/" /><link rel="prev" href="https://swjtulwy.github.io/gdb/" /><link rel="next" href="https://swjtulwy.github.io/ipc/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Unixæ–‡ä»¶IO",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/swjtulwy.github.io\/fileio\/"
        },"image": ["https:\/\/swjtulwy.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "C\/C\u002b\u002b, Unix","wordcount":  5283 ,
        "url": "https:\/\/swjtulwy.github.io\/fileio\/","datePublished": "2021-04-08T11:14:22+08:00","dateModified": "2021-04-08T11:14:22+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/swjtulwy.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Weiyee"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Weiyee&#39;s Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Weiyee&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> ğŸ“” æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"> ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> ğŸ—‚ï¸ åˆ†ç±» </a><a class="menu-item" href="/mypage/"> ğŸ‘¨â€ğŸ’» å…³äº </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Weiyee&#39;s Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Weiyee&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ğŸ“” æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸ æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—‚ï¸ åˆ†ç±»</a><a class="menu-item" href="/mypage/" title="">ğŸ‘¨â€ğŸ’» å…³äº</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Unixæ–‡ä»¶IO</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Weiyee</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/c/c++/"><i class="far fa-folder fa-fw"></i>C/C++</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-04-08">2021-04-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 5283 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 11 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp"
        data-srcset="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp, https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp 1.5x, https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp 2x"
        data-sizes="auto"
        alt="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp"
        title="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li>
    <li><a href="#åŸç†">åŸç†</a>
      <ul>
        <li><a href="#æ ˆä¸å †çš„æ‰©å±•æ–¹å‘">æ ˆä¸å †çš„æ‰©å±•æ–¹å‘</a></li>
      </ul>
    </li>
    <li><a href="#open">open</a></li>
    <li><a href="#read--write">read &amp; write</a></li>
    <li><a href="#lseek">lseek</a></li>
    <li><a href="#stat">stat</a></li>
    <li><a href="#access">access</a></li>
    <li><a href="#chmod">chmod</a></li>
    <li><a href="#truncate">truncate</a></li>
    <li><a href="#chdir--getcwd">chdir &amp; getcwd</a></li>
    <li><a href="#mkdir">mkdir</a></li>
    <li><a href="#opendir-readdir-closedir">opendir &amp;Â readdir &amp;Â closedir</a></li>
    <li><a href="#dup">dup</a></li>
    <li><a href="#dup2">dup2</a></li>
    <li><a href="#fcntl">fcntl</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>æœ¬æ–‡ä»‹ç»æ–‡ä»¶IOä¸æ ‡å‡†IOçš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶IOå‡½æ•°</p>
</blockquote>
<h2 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h2>
<p>æ–‡ä»¶I/Oï¼šæ–‡ä»¶I/Oç§°ä¹‹ä¸ºä¸å¸¦ç¼“å­˜çš„IOï¼ˆunbuffered I/O)ã€‚ä¸å¸¦ç¼“å­˜æŒ‡çš„æ˜¯æ¯ä¸ªreadï¼Œwriteéƒ½è°ƒç”¨å†…æ ¸ä¸­çš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯ä¸€èˆ¬æ‰€è¯´çš„ä½çº§I/Oâ€”â€”æ“ä½œç³»ç»Ÿæä¾›çš„åŸºæœ¬IOæœåŠ¡ï¼Œä¸osç»‘å®šï¼Œç‰¹å®šäºlinixæˆ–unixå¹³å°ã€‚</p>
<p>æ ‡å‡†I/Oï¼šæ ‡å‡†I/Oæ˜¯ANSI Cå»ºç«‹çš„ä¸€ä¸ªæ ‡å‡†I/Oæ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†å‡½æ•°åŒ…å’Œstdio.hå¤´æ–‡ä»¶ä¸­çš„å®šä¹‰ï¼Œå…·æœ‰ä¸€å®šçš„å¯ç§»æ¤æ€§ã€‚æ ‡å‡†I/Oåº“å¤„ç†å¾ˆå¤šç»†èŠ‚ã€‚ä¾‹å¦‚ç¼“å­˜åˆ†é…ï¼Œä»¥ä¼˜åŒ–é•¿åº¦æ‰§è¡ŒI/Oç­‰ã€‚æ ‡å‡†çš„I/Oæä¾›äº†ä¸‰ç§ç±»å‹çš„ç¼“å­˜ã€‚</p>
<p>ï¼ˆ1ï¼‰å…¨ç¼“å­˜ï¼šå½“å¡«æ»¡æ ‡å‡†I/Oç¼“å­˜åæ‰è¿›è¡Œå®é™…çš„I/Oæ“ä½œã€‚ 
ï¼ˆ2ï¼‰è¡Œç¼“å­˜ï¼šå½“è¾“å…¥æˆ–è¾“å‡ºä¸­é‡åˆ°æ–°è¡Œç¬¦æ—¶ï¼Œæ ‡å‡†I/Oåº“æ‰§è¡ŒI/Oæ“ä½œã€‚ 
ï¼ˆ3ï¼‰ä¸å¸¦ç¼“å­˜ï¼šstderrå°±æ˜¯äº†ã€‚</p>
<h2 id="åŸç†">åŸç†</h2>
<p>æ–‡ä»¶I/O åˆç§°ä¸ºä½çº§ç£ç›˜I/Oï¼Œéµå¾ªPOSIXç›¸å…³æ ‡å‡†ã€‚ä»»ä½•å…¼å®¹POSIXæ ‡å‡†çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æ”¯æŒæ–‡ä»¶I/Oã€‚æ ‡å‡†I/Oè¢«ç§°ä¸ºé«˜çº§ç£ç›˜I/Oï¼Œéµå¾ªANSI Cç›¸å…³æ ‡å‡†ã€‚åªè¦å¼€å‘ç¯å¢ƒä¸­æœ‰æ ‡å‡†I/Oåº“ï¼Œæ ‡å‡†I/Oå°±å¯ä»¥ä½¿ç”¨ã€‚ï¼ˆLinux ä¸­ä½¿ç”¨çš„æ˜¯GLIBCï¼Œå®ƒæ˜¯æ ‡å‡†Cåº“çš„è¶…é›†ã€‚ä¸ä»…åŒ…å«ANSI Cä¸­å®šä¹‰çš„å‡½æ•°ï¼Œè¿˜åŒ…æ‹¬POSIXæ ‡å‡†ä¸­å®šä¹‰çš„å‡½æ•°ã€‚å› æ­¤ï¼ŒLinux ä¸‹æ—¢å¯ä»¥ä½¿ç”¨æ ‡å‡†I/Oï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶I/Oï¼‰ã€‚</p>
<p>Â <img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp"
        data-srcset="https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp, https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp 1.5x, https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp 2x"
        data-sizes="auto"
        alt="https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp"
        title="https://i0.hdslb.com/bfs/album/1b598cc20a846cceece8c5d7aa937f2918611cd4.png@1e_1c.webp" /></p>
<img src="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp" title="" alt="" data-align="center">
<img src="https://i0.hdslb.com/bfs/album/585e83db0b3630fbfdf9a897c12fc0664ed41f97.png@1e_1c.webp" title="" alt="" data-align="center">
<img src="https://i0.hdslb.com/bfs/album/a184ddab313227b50954b660df90da0c3088167d.jpg@1e_1c.webp" title="" alt="" data-align="center">
<h3 id="æ ˆä¸å †çš„æ‰©å±•æ–¹å‘">æ ˆä¸å †çš„æ‰©å±•æ–¹å‘</h3>
<p><strong>æ—©æœŸçš„å¾®å¼±ä¼˜åŠ¿</strong></p>
<p>æ—©æœŸçš„ç³»ç»Ÿéœ€è¦è€ƒè™‘æœ‰é™å†…å­˜ä¸‹çš„å†…å­˜å¸ƒå±€é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œå†…å­˜çš„ä¸€ç«¯æ”¾ç½®äº†é™æ€ä»£ç å’Œé™æ€æ•°æ®ä¹‹åï¼Œå‰©ä½™çš„åŒºåŸŸï¼Œæ—¢éœ€è¦åŠ¨æ€æ•°æ®ï¼Œåˆéœ€è¦å¯å¢é•¿çš„æ ˆï¼Œé‚£ä¹ˆåˆç†çš„æ–¹æ¡ˆå°±æ˜¯å„æ”¾ä¸€ç«¯å‘ä¸­é—´ç”Ÿé•¿ã€‚ç°åœ¨çš„é—®é¢˜å°±æ˜¯ä¸¤ä¸ªé€‰é¡¹ï¼šé™æ€å†…å­˜æ”¾åœ¨å“ªç«¯ï¼›æ ˆæ˜¯åœ¨é™æ€å†…å­˜çš„åŒç«¯è¿˜æ˜¯å¯¹ç«¯ã€‚</p>
<p>è€ƒè™‘ä¸‹é¢çš„ä¸€äº›æ¡ä»¶ï¼š</p>
<ul>
<li>æ—©æœŸçš„éƒ¨åˆ†æœºå™¨ï¼Œä»0åœ°å€å¯åŠ¨[1]ã€‚æƒ³è±¡ä¸€ä¸‹ç£å¸¦æœºçš„<a href="https://www.zhihu.com/search?q=%E7%BC%96%E5%9D%80&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A373320074%7D" target="_blank" rel="noopener noreffer">ç¼–å€</a>ã€‚</li>
<li>åŠ¨æ€æ•°æ®ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œå’Œé™æ€æ•°æ®æ¯”è¾ƒåƒ</li>
</ul>
<p>æ‰€ä»¥ä»å†…å­˜å¸ƒå±€æ¥è¯´ï¼Œä¸€ä¸ªè‡ªç„¶çš„æ–¹æ¡ˆæ˜¯ï¼Œä»0åœ°å€ä¾æ¬¡æ”¾ç½®ä»£ç ã€é™æ€æ•°æ®ã€åŠ¨æ€æ•°æ®ï¼Œé«˜åœ°å€æ”¾ç½®æ ˆã€‚</p>
<p>ä½†æ˜¯ï¼Œä»å®‰å…¨æ€§æ¥è¯´ï¼Œå‘ä½åœ°å€æ‰©å±•ä¹Ÿæœ‰å¾®å¼±åŠ£åŠ¿ï¼š</p>
<ul>
<li>æ•°ç»„ã€å­—ç¬¦ä¸²è¶Šç•Œæ—¶ä¼šè¦†ç›–è¿‡å»æ ˆå¸§çš„æ•°æ®ï¼Œé»‘å®¢æ›´å®¹æ˜“æ‰¾åˆ°ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„æ¼æ´</li>
</ul>
<p><strong>å†å²çš„å®é™…æƒ…å†µ</strong></p>
<p>å¤§éƒ¨åˆ†CPU<a href="https://www.zhihu.com/search?q=%E6%8C%87%E4%BB%A4%E9%9B%86&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A373320074%7D" target="_blank" rel="noopener noreffer">æŒ‡ä»¤é›†</a>è®¾è®¡äº†å‡½æ•°è°ƒç”¨æ¶æ„ï¼Œå®šä¹‰äº†ä¸“ç”¨çš„è°ƒç”¨/è¿”å›æŒ‡ä»¤ï¼Œå¹¶åœ¨æŒ‡ä»¤ä¸­éšå«è§„å®šæ ˆçš„æ–¹å‘ã€‚</p>
<ul>
<li>ä¸»æµ1ï¼šå‘ä½åœ°å€æ‰©å±•ï¼šx86ï¼ŒMIPS</li>
<li>ä¸»æµ2ï¼šè‡ªç”±é€‰æ‹©ï¼šArmï¼ˆä½†ä¸ªåˆ«æŒ‡ä»¤ä»…æ”¯æŒå‘ä½ï¼‰</li>
<li>ç½•è§ï¼šå‘é«˜åœ°å€æ‰©å±•ï¼šPA-RISCï¼Œæ“ä½œç³»ç»ŸMultics</li>
<li>éä¸»æµï¼šSystem zï¼Œæ ˆæ˜¯ä¸ªé“¾è¡¨[2]</li>
</ul>
<p>å¦‚æœCPUåŒæ—¶æ”¯æŒå‘ä¸Šå’Œå‘ä¸‹ï¼Œä¾‹å¦‚armï¼Œé‚£ä¹ˆ<strong>ç¼–è¯‘å™¨</strong>éœ€è¦æŒ‡å®šç¨‹åºçš„è°ƒç”¨æ–¹å‘ï¼Œä¸€èˆ¬è¿˜æ˜¯é€‰æ‹©å‘ä¸‹ã€‚æ¯”è¾ƒç½•è§çš„æç«¯çš„æ¡ˆä¾‹æ˜¯Multicsæ“ä½œç³»ç»Ÿï¼Œè¿™æ˜¯Unixçš„å·¨æ— éœ¸å‰èº«ï¼Œè®¾è®¡è€…åˆ»æ„é€‰ç”¨å‘é«˜åœ°å€æ‰©å±•ï¼Œå› ä¸ºè¯¥æ¶æ„æœ‰åŠ©äºé˜²å¾¡ç¼“å†²åŒºæº¢å‡ºæ”»å‡»[3]ã€‚</p>
<p><strong>ç°ä»£çš„æƒ…å†µ</strong></p>
<p>ç°ä»£ç¨‹åºçš„ä¸‹åˆ—ç‰¹å¾ï¼Œå¯¼è‡´å†…å­˜å¸ƒå±€é—®é¢˜ä¸­çš„å•ä¸ªæ ˆå¢é•¿æ–¹å‘æ— æ‰€è°“ã€‚</p>
<ul>
<li>ä½¿ç”¨çº¿æ€§è™šæ‹Ÿåœ°å€ï¼Œè¿›ç¨‹ç©ºé—´ä¸º4Gæˆ–è€…æ›´é«˜</li>
<li>ç°ä»£ç¨‹åºå†™æ³•ï¼Œæ ˆçš„å¤§å°1Må·¦å³å·²ç»è¶³å¤Ÿä½¿ç”¨ã€‚ç¼–è¯‘å™¨ä¸€èˆ¬éƒ½ç›´æ¥é™åˆ¶æ ˆçš„å¤§å°</li>
<li>å¤šçº¿ç¨‹å¯¼è‡´æœ‰å¤šä¸ªæ ˆï¼Œæ‰€ä»¥å †-æ ˆçš„ä¸¤ç«¯åˆ†å‰²æ¨¡å¼æ˜¯ä¸åˆé€‚çš„ï¼Œæ¯ä¸ªæ ˆåº”å½“æœ‰ç•Œ</li>
</ul>
<p><strong>å¼•ç”¨</strong></p>
<p>ä½œè€…ï¼šåˆ˜æº<br>
é“¾æ¥ï¼šhttps://www.zhihu.com/question/29520755/answer/373320074<br>
æ¥æºï¼šçŸ¥ä¹<br>
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<img src="https://i0.hdslb.com/bfs/album/18ec9e555d615c702abf99afd4f03aece4229aa3.png@1e_1c.webp" title="" alt="" data-align="center">
<h2 id="open">open</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    #include &lt;sys/stat.h&gt;
</span><span class="cm">    #include &lt;fcntl.h&gt;
</span><span class="cm">    // æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶
</span><span class="cm">    int open(const char *pathname, int flags);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - pathnameï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„
</span><span class="cm">            - flagsï¼šå¯¹æ–‡ä»¶çš„æ“ä½œæƒé™è®¾ç½®è¿˜æœ‰å…¶ä»–çš„è®¾ç½®
</span><span class="cm">              O_RDONLY,  O_WRONLY,  O_RDWR  è¿™ä¸‰ä¸ªè®¾ç½®æ˜¯äº’æ–¥çš„
</span><span class="cm">        è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè¿”å›-1
</span><span class="cm">    errnoï¼šå±äºLinuxç³»ç»Ÿå‡½æ•°åº“ï¼Œåº“é‡Œé¢çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè®°å½•çš„æ˜¯æœ€è¿‘çš„é”™è¯¯å·ã€‚
</span><span class="cm">
</span><span class="cm">    #include &lt;stdio.h&gt;
</span><span class="cm">    void perror(const char *s);ä½œç”¨ï¼šæ‰“å°errnoå¯¹åº”çš„é”™è¯¯æè¿°
</span><span class="cm">        så‚æ•°ï¼šç”¨æˆ·æè¿°ï¼Œæ¯”å¦‚hello,æœ€ç»ˆè¾“å‡ºçš„å†…å®¹æ˜¯  hello:xxx(å®é™…çš„é”™è¯¯æè¿°)
</span><span class="cm">
</span><span class="cm">    // åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶
</span><span class="cm">    int open(const char *pathname, int flags, mode_t mode);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - pathnameï¼šè¦åˆ›å»ºçš„æ–‡ä»¶çš„è·¯å¾„
</span><span class="cm">            - flagsï¼šå¯¹æ–‡ä»¶çš„æ“ä½œæƒé™å’Œå…¶ä»–çš„è®¾ç½®
</span><span class="cm">                - å¿…é€‰é¡¹ï¼šO_RDONLY,  O_WRONLY, O_RDWR  è¿™ä¸‰ä¸ªä¹‹é—´æ˜¯äº’æ–¥çš„
</span><span class="cm">                - å¯é€‰é¡¹ï¼šO_CREAT æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
</span><span class="cm">            - modeï¼šå…«è¿›åˆ¶çš„æ•°ï¼Œè¡¨ç¤ºåˆ›å»ºå‡ºçš„æ–°çš„æ–‡ä»¶çš„æ“ä½œæƒé™ï¼Œæ¯”å¦‚ï¼š0775
</span><span class="cm">            æœ€ç»ˆçš„æƒé™æ˜¯ï¼šmode &amp; ~umask
</span><span class="cm">            0777   -&gt;   111111111
</span><span class="cm">        &amp;   0775   -&gt;   111111101
</span><span class="cm">        ----------------------------
</span><span class="cm">                        111111101
</span><span class="cm">        æŒ‰ä½ä¸ï¼š0å’Œä»»ä½•æ•°éƒ½ä¸º0
</span><span class="cm">        umaskçš„ä½œç”¨å°±æ˜¯æŠ¹å»æŸäº›æƒé™ã€‚
</span><span class="cm">
</span><span class="cm">        flagså‚æ•°æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œ32ä½ã€‚
</span><span class="cm">        flags 32ä¸ªä½ï¼Œæ¯ä¸€ä½å°±æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ã€‚
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;a.txt&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// è¯»å†™æ“ä½œ
</span><span class="c1"></span>    <span class="c1">// å…³é—­
</span><span class="c1"></span>    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="read--write">read &amp; write</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*  
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    ssize_t read(int fd, void *buf, size_t count);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopenå¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
</span><span class="cm">            - bufï¼šéœ€è¦è¯»å–æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼Œæ•°ç»„çš„åœ°å€ï¼ˆä¼ å‡ºå‚æ•°ï¼‰
</span><span class="cm">            - countï¼šæŒ‡å®šçš„æ•°ç»„çš„å¤§å°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            - æˆåŠŸï¼š
</span><span class="cm">                &gt;0: è¿”å›å®é™…çš„è¯»å–åˆ°çš„å­—èŠ‚æ•°
</span><span class="cm">                =0ï¼šæ–‡ä»¶å·²ç»è¯»å–å®Œäº†
</span><span class="cm">            - å¤±è´¥ï¼š-1 ï¼Œå¹¶ä¸”è®¾ç½®errno
</span><span class="cm">
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    ssize_t write(int fd, const void *buf, size_t count);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopenå¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
</span><span class="cm">            - bufï¼šè¦å¾€ç£ç›˜å†™å…¥çš„æ•°æ®ï¼Œæ•°æ®
</span><span class="cm">            - countï¼šè¦å†™çš„æ•°æ®çš„å®é™…çš„å¤§å°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸï¼šå®é™…å†™å…¥çš„å­—èŠ‚æ•°
</span><span class="cm">            å¤±è´¥ï¼šè¿”å›-1ï¼Œå¹¶è®¾ç½®errno
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// 1.é€šè¿‡openæ‰“å¼€english.txtæ–‡ä»¶
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">srcfd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;english.txt&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">srcfd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 2.åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼ˆæ‹·è´æ–‡ä»¶ï¼‰
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">destfd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;cpy.txt&#34;</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">destfd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 3.é¢‘ç¹çš„è¯»å†™æ“ä½œ
</span><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">srcfd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">write</span><span class="p">(</span><span class="n">destfd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 4.å…³é—­æ–‡ä»¶
</span><span class="c1"></span>    <span class="n">close</span><span class="p">(</span><span class="n">destfd</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">srcfd</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="lseek">lseek</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*  
</span><span class="cm">    æ ‡å‡†Cåº“çš„å‡½æ•°
</span><span class="cm">    #include &lt;stdio.h&gt;
</span><span class="cm">    int fseek(FILE *stream, long offset, int whence);
</span><span class="cm">
</span><span class="cm">    Linuxç³»ç»Ÿå‡½æ•°
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    off_t lseek(int fd, off_t offset, int whence);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡openå¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªfdæ“ä½œæŸä¸ªæ–‡ä»¶
</span><span class="cm">            - offsetï¼šåç§»é‡
</span><span class="cm">            - whence:
</span><span class="cm">                SEEK_SET
</span><span class="cm">                    è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„åç§»é‡
</span><span class="cm">                SEEK_CUR
</span><span class="cm">                    è®¾ç½®åç§»é‡ï¼šå½“å‰ä½ç½® + ç¬¬äºŒä¸ªå‚æ•°offsetçš„å€¼
</span><span class="cm">                SEEK_END
</span><span class="cm">                    è®¾ç½®åç§»é‡ï¼šæ–‡ä»¶å¤§å° + ç¬¬äºŒä¸ªå‚æ•°offsetçš„å€¼
</span><span class="cm">        è¿”å›å€¼ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®
</span><span class="cm">
</span><span class="cm">
</span><span class="cm">    ä½œç”¨ï¼š
</span><span class="cm">        1.ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æ–‡ä»¶å¤´
</span><span class="cm">        lseek(fd, 0, SEEK_SET);
</span><span class="cm">
</span><span class="cm">        2.è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®
</span><span class="cm">        lseek(fd, 0, SEEK_CUR);
</span><span class="cm">
</span><span class="cm">        3.è·å–æ–‡ä»¶é•¿åº¦
</span><span class="cm">        lseek(fd, 0, SEEK_END);
</span><span class="cm">
</span><span class="cm">        4.æ‹“å±•æ–‡ä»¶çš„é•¿åº¦ï¼Œå½“å‰æ–‡ä»¶10b, 110b, å¢åŠ äº†100ä¸ªå­—èŠ‚
</span><span class="cm">        lseek(fd, 100, SEEK_END)
</span><span class="cm">        æ³¨æ„ï¼šéœ€è¦å†™ä¸€æ¬¡æ•°æ®
</span><span class="cm">
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;hello.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// æ‰©å±•æ–‡ä»¶çš„é•¿åº¦
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;lseek&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// å†™å…¥ä¸€ä¸ªç©ºæ•°æ®
</span><span class="c1"></span>    <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// å…³é—­æ–‡ä»¶
</span><span class="c1"></span>    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="stat">stat</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    #include &lt;sys/stat.h&gt;
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">
</span><span class="cm">    int stat(const char *pathname, struct stat *statbuf);
</span><span class="cm">        ä½œç”¨ï¼šè·å–ä¸€ä¸ªæ–‡ä»¶ç›¸å…³çš„ä¸€äº›ä¿¡æ¯
</span><span class="cm">        å‚æ•°:
</span><span class="cm">            - pathnameï¼šæ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
</span><span class="cm">            - statbufï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸï¼šè¿”å›0
</span><span class="cm">            å¤±è´¥ï¼šè¿”å›-1 è®¾ç½®errno
</span><span class="cm">
</span><span class="cm">    int lstat(const char *pathname, struct stat *statbuf);
</span><span class="cm">        å‚æ•°:
</span><span class="cm">            - pathnameï¼šæ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
</span><span class="cm">            - statbufï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸï¼šè¿”å›0
</span><span class="cm">            å¤±è´¥ï¼šè¿”å›-1 è®¾ç½®errno
</span><span class="cm">
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">struct</span> <span class="n">stat</span> <span class="n">statbuf</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">stat</span><span class="p">(</span><span class="s">&#34;a.txt&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statbuf</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;stat&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;size: %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">statbuf</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span><span class="n">access</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="access">access</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    int access(const char *pathname, int mode);
</span><span class="cm">        ä½œç”¨ï¼šåˆ¤æ–­æŸä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Œæˆ–è€…åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - pathname: åˆ¤æ–­çš„æ–‡ä»¶è·¯å¾„
</span><span class="cm">            - mode:
</span><span class="cm">                R_OK: åˆ¤æ–­æ˜¯å¦æœ‰è¯»æƒé™
</span><span class="cm">                W_OK: åˆ¤æ–­æ˜¯å¦æœ‰å†™æƒé™
</span><span class="cm">                X_OK: åˆ¤æ–­æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
</span><span class="cm">                F_OK: åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
</span><span class="cm">        è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œ å¤±è´¥è¿”å›-1
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">access</span><span class="p">(</span><span class="s">&#34;a.txt&#34;</span><span class="p">,</span> <span class="n">F_OK</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;access&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;æ–‡ä»¶å­˜åœ¨ï¼ï¼!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="chmod">chmod</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;sys/stat.h&gt;
</span><span class="cm">    int chmod(const char *pathname, mode_t mode);
</span><span class="cm">        ä¿®æ”¹æ–‡ä»¶çš„æƒé™
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - pathname: éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
</span><span class="cm">            - mode:éœ€è¦ä¿®æ”¹çš„æƒé™å€¼ï¼Œå…«è¿›åˆ¶çš„æ•°
</span><span class="cm">        è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1
</span><span class="cm">
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">chmod</span><span class="p">(</span><span class="s">&#34;a.txt&#34;</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;chmod&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="truncate">truncate</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    int truncate(const char *path, off_t length);
</span><span class="cm">        ä½œç”¨ï¼šç¼©å‡æˆ–è€…æ‰©å±•æ–‡ä»¶çš„å°ºå¯¸è‡³æŒ‡å®šçš„å¤§å°
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - path: éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
</span><span class="cm">            - length: éœ€è¦æœ€ç»ˆæ–‡ä»¶å˜æˆçš„å¤§å°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸè¿”å›0ï¼Œ å¤±è´¥è¿”å›-1
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">truncate</span><span class="p">(</span><span class="s">&#34;b.txt&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;truncate&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>Â 
</code></pre></td></tr></table>
</div>
</div><h2 id="chdir--getcwd">chdir &amp; getcwd</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    int chdir(const char *path);
</span><span class="cm">        ä½œç”¨ï¼šä¿®æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•
</span><span class="cm">            æ¯”å¦‚åœ¨/home/nowcoder å¯åŠ¨äº†ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºa.out, è¿›ç¨‹çš„å·¥ä½œç›®å½• /home/nowcoder
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            path : éœ€è¦ä¿®æ”¹çš„å·¥ä½œç›®å½•
</span><span class="cm">
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    char *getcwd(char *buf, size_t size);
</span><span class="cm">        ä½œç”¨ï¼šè·å–å½“å‰å·¥ä½œç›®å½•
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - buf : å­˜å‚¨çš„è·¯å¾„ï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆä¼ å‡ºå‚æ•°ï¼‰
</span><span class="cm">            - size: æ•°ç»„çš„å¤§å°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            è¿”å›çš„æŒ‡å‘çš„ä¸€å—å†…å­˜ï¼Œè¿™ä¸ªæ•°æ®å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°
</span><span class="cm">
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// è·å–å½“å‰çš„å·¥ä½œç›®å½•
</span><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="n">getcwd</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;å½“å‰çš„å·¥ä½œç›®å½•æ˜¯ï¼š%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

    <span class="c1">// ä¿®æ”¹å·¥ä½œç›®å½•
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">chdir</span><span class="p">(</span><span class="s">&#34;/home/nowcoder/Linux/lesson13&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;chdir&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="c1">// åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;chdir.txt&#34;</span><span class="p">,</span> <span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">O_RDWR</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="c1">// è·å–å½“å‰çš„å·¥ä½œç›®å½•
</span><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf1</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="n">getcwd</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf1</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;å½“å‰çš„å·¥ä½œç›®å½•æ˜¯ï¼š%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf1</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="mkdir">mkdir</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;sys/stat.h&gt;
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    int mkdir(const char *pathname, mode_t mode);
</span><span class="cm">        ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªç›®å½•
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            pathname: åˆ›å»ºçš„ç›®å½•çš„è·¯å¾„
</span><span class="cm">            mode: æƒé™ï¼Œå…«è¿›åˆ¶çš„æ•°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸè¿”å›0ï¼Œ å¤±è´¥è¿”å›-1
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">mkdir</span><span class="p">(</span><span class="s">&#34;aaa&#34;</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;mkdir&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="opendir-readdir-closedir">opendir &amp;Â readdir &amp;Â closedir</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    // æ‰“å¼€ä¸€ä¸ªç›®å½•
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    #include &lt;dirent.h&gt;
</span><span class="cm">    DIR *opendir(const char *name);
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            - name: éœ€è¦æ‰“å¼€çš„ç›®å½•çš„åç§°
</span><span class="cm">        è¿”å›å€¼ï¼š
</span><span class="cm">            DIR * ç±»å‹ï¼Œç†è§£ä¸ºç›®å½•æµ
</span><span class="cm">            é”™è¯¯è¿”å›NULL
</span><span class="cm">
</span><span class="cm">
</span><span class="cm">    // è¯»å–ç›®å½•ä¸­çš„æ•°æ®
</span><span class="cm">    #include &lt;dirent.h&gt;
</span><span class="cm">    struct dirent *readdir(DIR *dirp);
</span><span class="cm">        - å‚æ•°ï¼šdirpæ˜¯opendirè¿”å›çš„ç»“æœ
</span><span class="cm">        - è¿”å›å€¼ï¼š
</span><span class="cm">            struct direntï¼Œä»£è¡¨è¯»å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
</span><span class="cm">            è¯»å–åˆ°äº†æœ«å°¾æˆ–è€…å¤±è´¥äº†ï¼Œè¿”å›NULL
</span><span class="cm">
</span><span class="cm">    // å…³é—­ç›®å½•
</span><span class="cm">    #include &lt;sys/types.h&gt;
</span><span class="cm">    #include &lt;dirent.h&gt;
</span><span class="cm">    int closedir(DIR *dirp);
</span><span class="cm">
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">getFileNum</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">path</span><span class="p">);</span>

<span class="c1">// è¯»å–æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s path</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">getFileNum</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°ä¸ºï¼š%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ç”¨äºè·å–ç›®å½•ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">getFileNum</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 1.æ‰“å¼€ç›®å½•
</span><span class="c1"></span>    <span class="n">DIR</span> <span class="o">*</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;opendir&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>

    <span class="c1">// è®°å½•æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span><span class="p">((</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// è·å–åç§°
</span><span class="c1"></span>        <span class="kt">char</span> <span class="o">*</span> <span class="n">dname</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">;</span>

        <span class="c1">// å¿½ç•¥æ‰. å’Œ..
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="s">&#34;..&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// åˆ¤æ–­æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç›®å½•
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">d_type</span> <span class="o">==</span> <span class="n">DT_DIR</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ç›®å½•,éœ€è¦ç»§ç»­è¯»å–è¿™ä¸ªç›®å½•
</span><span class="c1"></span>            <span class="kt">char</span> <span class="n">newpath</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
            <span class="n">sprintf</span><span class="p">(</span><span class="n">newpath</span><span class="p">,</span> <span class="s">&#34;%s/%s&#34;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">dname</span><span class="p">);</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">getFileNum</span><span class="p">(</span><span class="n">newpath</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">d_type</span> <span class="o">==</span> <span class="n">DT_REG</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ™®é€šæ–‡ä»¶
</span><span class="c1"></span>            <span class="n">total</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>


    <span class="p">}</span>

    <span class="c1">// å…³é—­ç›®å½•
</span><span class="c1"></span>    <span class="n">closedir</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="dup">dup</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    int dup(int oldfd);
</span><span class="cm">        ä½œç”¨ï¼šå¤åˆ¶ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦
</span><span class="cm">        fd=3, int fd1 = dup(fd),
</span><span class="cm">        fdæŒ‡å‘çš„æ˜¯a.txt, fd1ä¹Ÿæ˜¯æŒ‡å‘a.txt
</span><span class="cm">        ä»ç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ‰¾ä¸€ä¸ªæœ€å°çš„ï¼Œä½œä¸ºæ–°çš„æ‹·è´çš„æ–‡ä»¶æè¿°ç¬¦
</span><span class="cm">
</span><span class="cm">
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;a.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">fd1</span> <span class="o">=</span> <span class="n">dup</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">fd1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;dup&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;fd : %d , fd1 : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd1</span><span class="p">);</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;hello,world&#34;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">fd1</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;write&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd1</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="dup2">dup2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    int dup2(int oldfd, int newfd);
</span><span class="cm">        ä½œç”¨ï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦
</span><span class="cm">        oldfd æŒ‡å‘ a.txt, newfd æŒ‡å‘ b.txt
</span><span class="cm">        è°ƒç”¨å‡½æ•°æˆåŠŸåï¼šnewfd å’Œ b.txt åšclose, newfd æŒ‡å‘äº† a.txt
</span><span class="cm">        oldfd å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦
</span><span class="cm">        oldfdå’Œnewfdå€¼ç›¸åŒï¼Œç›¸å½“äºä»€ä¹ˆéƒ½æ²¡æœ‰åš
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">fd1</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;2.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;fd : %d, fd1 : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd1</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">fd2</span> <span class="o">=</span> <span class="n">dup2</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fd1</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;dup2&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// é€šè¿‡fd1å»å†™æ•°æ®ï¼Œå®é™…æ“ä½œçš„æ˜¯1.txtï¼Œè€Œä¸æ˜¯2.txt
</span><span class="c1"></span>    <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;hello, dup2&#34;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">fd1</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>

    <span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;write&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;fd : %d, fd1 : %d, fd2 : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fd1</span><span class="p">,</span> <span class="n">fd2</span><span class="p">);</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd1</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="fcntl">fcntl</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">
</span><span class="cm">    #include &lt;unistd.h&gt;
</span><span class="cm">    #include &lt;fcntl.h&gt;
</span><span class="cm">
</span><span class="cm">    int fcntl(int fd, int cmd, ...);
</span><span class="cm">    å‚æ•°ï¼š
</span><span class="cm">        fd : è¡¨ç¤ºéœ€è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦
</span><span class="cm">        cmd: è¡¨ç¤ºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå¦‚ä½•æ“ä½œ
</span><span class="cm">            - F_DUPFD : å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦,å¤åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°fdï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆè¿”å›å€¼ï¼‰
</span><span class="cm">                int ret = fcntl(fd, F_DUPFD);
</span><span class="cm">
</span><span class="cm">            - F_GETFL : è·å–æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€flag
</span><span class="cm">              è·å–çš„flagå’Œæˆ‘ä»¬é€šè¿‡openå‡½æ•°ä¼ é€’çš„flagæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚
</span><span class="cm">
</span><span class="cm">            - F_SETFL : è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€flag
</span><span class="cm">              å¿…é€‰é¡¹ï¼šO_RDONLY, O_WRONLY, O_RDWR ä¸å¯ä»¥è¢«ä¿®æ”¹
</span><span class="cm">              å¯é€‰æ€§ï¼šO_APPEND, O)NONBLOCK
</span><span class="cm">                O_APPEND è¡¨ç¤ºè¿½åŠ æ•°æ®
</span><span class="cm">                NONBLOK è®¾ç½®æˆéé˜»å¡
</span><span class="cm">
</span><span class="cm">        é˜»å¡å’Œéé˜»å¡ï¼šæè¿°çš„æ˜¯å‡½æ•°è°ƒç”¨çš„è¡Œä¸ºã€‚
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// 1.å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦
</span><span class="c1"></span>    <span class="c1">// int fd = open(&#34;1.txt&#34;, O_RDONLY);
</span><span class="c1"></span>    <span class="c1">// int ret = fcntl(fd, F_DUPFD);
</span><span class="c1"></span>
    <span class="c1">// 2.ä¿®æ”¹æˆ–è€…è·å–æ–‡ä»¶çŠ¶æ€flag
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// è·å–æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€flag
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_GETFL</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fcntl&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">flag</span> <span class="o">|=</span> <span class="n">O_APPEND</span><span class="p">;</span>   <span class="c1">// flag = flag | O_APPEND
</span><span class="c1"></span>
    <span class="c1">// ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€çš„flagï¼Œç»™flagåŠ å…¥O_APPENDè¿™ä¸ªæ ‡è®°
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_SETFL</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fcntl&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;nihao&#34;</span><span class="p">;</span>
    <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>

    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-04-08</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/fileio/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://swjtulwy.github.io/fileio/" data-title="Unixæ–‡ä»¶IO" data-hashtags="C/C&#43;&#43;,Unix"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://swjtulwy.github.io/fileio/" data-title="Unixæ–‡ä»¶IO" data-image="https://i0.hdslb.com/bfs/album/a5956cbf6cc82995ce1afdcdf77e73d9c14748b2.png@1e_1c.webp" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>,&nbsp;<a href="/tags/unix/">Unix</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/gdb/" class="prev" rel="prev" title="GDBè°ƒè¯•åŸºç¡€"><i class="fas fa-angle-left fa-fw"></i>GDBè°ƒè¯•åŸºç¡€</a>
            <a href="/ipc/" class="next" rel="next" title="Linuxå¤šè¿›ç¨‹é€šä¿¡">Linuxå¤šè¿›ç¨‹é€šä¿¡<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Weiyee</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":30},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
