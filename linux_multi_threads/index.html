<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <meta name="referrer" content="no-referrer">
        <title>Linuxä¸‹çš„å¤šçº¿ç¨‹ - Weiyee&#39;s Blog</title><meta name="Description" content="è®°å½•ä¸ªäººå­¦ä¹ çš„åšå®¢"><meta property="og:title" content="Linuxä¸‹çš„å¤šçº¿ç¨‹" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/linux_multi_threads/" /><meta property="og:image" content="https://example.com/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-12T16:18:55+08:00" />
<meta property="article:modified_time" content="2021-04-12T16:18:55+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://example.com/logo.png"/>

<meta name="twitter:title" content="Linuxä¸‹çš„å¤šçº¿ç¨‹"/>
<meta name="twitter:description" content=""/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://example.com/linux_multi_threads/" /><link rel="prev" href="https://example.com/ipc/" /><link rel="next" href="https://example.com/cmake_tutorial/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Linuxä¸‹çš„å¤šçº¿ç¨‹",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/example.com\/linux_multi_threads\/"
        },"image": ["https:\/\/example.com\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "Unix, MultiThreads","wordcount":  8355 ,
        "url": "https:\/\/example.com\/linux_multi_threads\/","datePublished": "2021-04-12T16:18:55+08:00","dateModified": "2021-04-12T16:18:55+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/example.com\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Weiyee"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Weiyee&#39;s Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Weiyee&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> ğŸ“” æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"> ğŸ·ï¸ æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> ğŸ—‚ï¸ åˆ†ç±» </a><a class="menu-item" href="/mypage/"> ğŸ‘¨â€ğŸ’» å…³äº </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Weiyee&#39;s Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Weiyee&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">ğŸ“” æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="">ğŸ·ï¸ æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">ğŸ—‚ï¸ åˆ†ç±»</a><a class="menu-item" href="/mypage/" title="">ğŸ‘¨â€ğŸ’» å…³äº</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Linuxä¸‹çš„å¤šçº¿ç¨‹</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Weiyee</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/operating-system/"><i class="far fa-folder fa-fw"></i>Operating System</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-04-12">2021-04-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 8355 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 17 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp"
        data-srcset="https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp, https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp 1.5x, https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp 2x"
        data-sizes="auto"
        alt="https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp"
        title="https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#çº¿ç¨‹æ¦‚è¿°">çº¿ç¨‹æ¦‚è¿°</a>
      <ul>
        <li><a href="#è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„åŒºåˆ«">è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„åŒºåˆ«</a></li>
      </ul>
    </li>
    <li><a href="#çº¿ç¨‹åŸºæœ¬æ“ä½œ">çº¿ç¨‹åŸºæœ¬æ“ä½œ</a>
      <ul>
        <li><a href="#çº¿ç¨‹åˆ›å»ºcreate">çº¿ç¨‹åˆ›å»ºï¼ˆcreateï¼‰</a></li>
        <li><a href="#çº¿ç¨‹ç»ˆæ­¢exit">çº¿ç¨‹ç»ˆæ­¢ï¼ˆexitï¼‰</a></li>
        <li><a href="#çº¿ç¨‹æ±‡åˆjoin">çº¿ç¨‹æ±‡åˆï¼ˆjoinï¼‰</a></li>
        <li><a href="#çº¿ç¨‹åˆ†ç¦»detach">çº¿ç¨‹åˆ†ç¦»ï¼ˆdetachï¼‰</a></li>
        <li><a href="#çº¿ç¨‹å–æ¶ˆcancel">çº¿ç¨‹å–æ¶ˆï¼ˆcancelï¼‰</a></li>
        <li><a href="#çº¿ç¨‹å±æ€§attr">çº¿ç¨‹å±æ€§ï¼ˆattrï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#çº¿ç¨‹åŒæ­¥synchronization">çº¿ç¨‹åŒæ­¥ï¼ˆsynchronizationï¼‰</a>
      <ul>
        <li><a href="#äº’æ–¥é‡é”">äº’æ–¥é‡ï¼ˆé”ï¼‰</a>
          <ul>
            <li><a href="#äº’æ–¥é‡åŸºæœ¬åŸç†">äº’æ–¥é‡åŸºæœ¬åŸç†</a></li>
            <li><a href="#äº’æ–¥é‡ç¤ºä¾‹">äº’æ–¥é‡ç¤ºä¾‹</a></li>
          </ul>
        </li>
        <li><a href="#æ­»é”">æ­»é”</a>
          <ul>
            <li><a href="#æ­»é”çš„å‡ ç§åœºæ™¯">æ­»é”çš„å‡ ç§åœºæ™¯</a></li>
            <li><a href="#æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶">æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶</a></li>
            <li><a href="#æ­»é”å¤„ç†æ–¹æ³•">æ­»é”å¤„ç†æ–¹æ³•</a></li>
            <li><a href="#æ­»é”ç¤ºä¾‹">æ­»é”ç¤ºä¾‹</a></li>
          </ul>
        </li>
        <li><a href="#è¯»å†™é”">è¯»å†™é”</a></li>
        <li><a href="#æ¡ä»¶å˜é‡">æ¡ä»¶å˜é‡</a></li>
        <li><a href="#ä¿¡å·é‡">ä¿¡å·é‡</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="çº¿ç¨‹æ¦‚è¿°">çº¿ç¨‹æ¦‚è¿°</h2>
<p>ä¸è¿›ç¨‹ï¼ˆ<code>process</code>ï¼‰ç±»ä¼¼ï¼Œçº¿ç¨‹ï¼ˆ<code>thread</code>ï¼‰æ˜¯å…è®¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„ä¸€ç§æœºåˆ¶ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚åŒä¸€ä¸ªç¨‹åºä¸­çš„æ‰€æœ‰çº¿ç¨‹å‡ä¼šç‹¬ç«‹æ‰§è¡Œç›¸åŒç¨‹åºï¼Œä¸”å…±äº«åŒä¸€ä»½å…¨å±€å†…å­˜åŒºåŸŸï¼Œå…¶ä¸­åŒ…æ‹¬åˆå§‹åŒ–æ•°æ®æ®µã€æœªåˆå§‹åŒ–æ•°æ®æ®µï¼Œä»¥åŠå †å†…å­˜æ®µã€‚ï¼ˆä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ UNIX è¿›ç¨‹åªæ˜¯å¤šçº¿ç¨‹ç¨‹åºçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œè¯¥è¿›ç¨‹åªåŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼‰</p>
<p>è¿›ç¨‹æ˜¯ CPU åˆ†é…èµ„æºçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œçš„æœ€å°å•ä½ã€‚</p>
<p>çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼ˆ<code>LWPï¼šLight Weight Process</code>ï¼‰ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹çº¿ç¨‹çš„æœ¬è´¨ä»æ˜¯è¿›ç¨‹ã€‚</p>
<p>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ LWP å·ï¼š<code>ps â€“Lf pi</code></p>
<p>â—¼ å½“ Linux æœ€åˆå¼€å‘æ—¶ï¼Œåœ¨å†…æ ¸ä¸­å¹¶ä¸èƒ½çœŸæ­£æ”¯æŒçº¿ç¨‹ã€‚ä½†æ˜¯å®ƒçš„ç¡®å¯ä»¥é€šè¿‡ clone()  ç³»ç»Ÿè°ƒç”¨å°†è¿›ç¨‹ä½œä¸ºå¯è°ƒåº¦çš„å®ä½“ã€‚è¿™ä¸ªè°ƒç”¨åˆ›å»ºäº†è°ƒç”¨è¿›ç¨‹ï¼ˆcalling processï¼‰çš„ ä¸€ä¸ªæ‹·è´ï¼Œè¿™ä¸ªæ‹·è´ä¸è°ƒç”¨è¿›ç¨‹å…±äº«ç›¸åŒçš„åœ°å€ç©ºé—´ã€‚LinuxThreads é¡¹ç›®ä½¿ç”¨è¿™ä¸ªè°ƒç”¨æ¥å®Œæˆåœ¨ç”¨æˆ·ç©ºé—´æ¨¡æ‹Ÿå¯¹çº¿ç¨‹çš„æ”¯æŒã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå°¤å…¶æ˜¯åœ¨ä¿¡å·å¤„ç†ã€è°ƒåº¦å’Œè¿›ç¨‹é—´åŒæ­¥ç­‰æ–¹é¢éƒ½å­˜åœ¨é—®é¢˜ã€‚å¦å¤–ï¼Œè¿™ä¸ªçº¿ç¨‹æ¨¡å‹ä¹Ÿä¸ç¬¦åˆ POSIX çš„è¦æ±‚ã€‚</p>
<p>â—¼ è¦æ”¹è¿› LinuxThreadsï¼Œéœ€è¦å†…æ ¸çš„æ”¯æŒï¼Œå¹¶ä¸”é‡å†™çº¿ç¨‹åº“ã€‚æœ‰ä¸¤ä¸ªç›¸äº’ç«äº‰çš„é¡¹ç›®å¼€å§‹ 
æ¥æ»¡è¶³è¿™äº›è¦æ±‚ã€‚ä¸€ä¸ªåŒ…æ‹¬ IBM çš„å¼€å‘äººå‘˜çš„å›¢é˜Ÿå¼€å±•äº† NGPTï¼ˆNext-Generation POSIX Threadsï¼‰é¡¹ç›®ã€‚åŒæ—¶ï¼ŒRed Hat çš„ä¸€äº›å¼€å‘äººå‘˜å¼€å±•äº† NPTL é¡¹ç›®ã€‚NGPT åœ¨ 2003 å¹´ä¸­æœŸè¢«æ”¾å¼ƒäº†ï¼ŒæŠŠè¿™ä¸ªé¢†åŸŸå®Œå…¨ç•™ç»™äº† <strong>NPTL</strong>ã€‚</p>
<p>â—¼ NPTLï¼Œæˆ–ç§°ä¸º <strong>Native POSIX Thread Library</strong>ï¼Œæ˜¯ Linux çº¿ç¨‹çš„ä¸€ä¸ªæ–°å®ç°ï¼Œå®ƒå…‹æœäº† LinuxThreads çš„ç¼ºç‚¹ï¼ŒåŒæ—¶ä¹Ÿç¬¦åˆ POSIX çš„éœ€æ±‚ã€‚ä¸ LinuxThreads ç›¸æ¯”ï¼Œå®ƒåœ¨æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢éƒ½æä¾›äº†é‡å¤§çš„æ”¹è¿›ã€‚</p>
<p>â—¼ æŸ¥çœ‹å½“å‰ pthread åº“ç‰ˆæœ¬ï¼š<code>getconf GNU_LIBPTHREAD_VERSION</code></p>
<h3 id="è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„åŒºåˆ«">è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„åŒºåˆ«</h3>
<p>è¿›ç¨‹é—´çš„ä¿¡æ¯éš¾ä»¥å…±äº«ã€‚ç”±äºé™¤å»åªè¯»ä»£ç æ®µå¤–ï¼Œçˆ¶å­è¿›ç¨‹å¹¶æœªå…±äº«å†…å­˜ï¼Œå› æ­¤å¿…é¡»é‡‡ç”¨
ä¸€äº›è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œåœ¨è¿›ç¨‹é—´è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚</p>
<p>è°ƒç”¨<code>fork()</code>æ¥åˆ›å»ºè¿›ç¨‹çš„ä»£ä»·ç›¸å¯¹è¾ƒé«˜ï¼Œå³ä¾¿åˆ©ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œä»ç„¶éœ€è¦å¤åˆ¶è¯¸å¦‚å†…å­˜é¡µè¡¨å’Œæ–‡ä»¶æè¿°ç¬¦è¡¨ä¹‹ç±»çš„å¤šç§è¿›ç¨‹å±æ€§ï¼Œè¿™æ„å‘³ç€ <code>fork()</code> è°ƒç”¨åœ¨æ—¶é—´ä¸Šçš„å¼€é”€ä¾ç„¶ä¸è²ã€‚</p>
<p>çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿæ–¹ä¾¿ã€å¿«é€Ÿåœ°å…±äº«ä¿¡æ¯ã€‚åªéœ€å°†æ•°æ®å¤åˆ¶åˆ°å…±äº«ï¼ˆå…¨å±€æˆ–å †ï¼‰å˜é‡ä¸­å³å¯ã€‚</p>
<p>åˆ›å»ºçº¿ç¨‹æ¯”åˆ›å»ºè¿›ç¨‹é€šå¸¸è¦å¿« 10 å€ç”šè‡³æ›´å¤šã€‚çº¿ç¨‹é—´æ˜¯å…±äº«è™šæ‹Ÿåœ°å€ç©ºé—´çš„ï¼Œæ— éœ€é‡‡ç”¨å†™æ—¶å¤åˆ¶æ¥å¤åˆ¶å†…å­˜ï¼Œä¹Ÿæ— éœ€å¤åˆ¶é¡µè¡¨</p>
<img src="https://i0.hdslb.com/bfs/album/9c205712fa159a31956020d9892976988a945541.png" title="" alt="" data-align="center">
<h2 id="çº¿ç¨‹åŸºæœ¬æ“ä½œ">çº¿ç¨‹åŸºæœ¬æ“ä½œ</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">pthread_create</span><span class="p">(</span><span class="n">pthread_t</span> <span class="o">*</span><span class="kr">thread</span><span class="p">,</span> <span class="k">const</span> <span class="n">pthread_attr_t</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> 
<span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">start_routine</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
<span class="n">pthread_t</span> <span class="nf">pthread_self</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">pthread_equal</span><span class="p">(</span><span class="n">pthread_t</span> <span class="n">t1</span><span class="p">,</span> <span class="n">pthread_t</span> <span class="n">t2</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">pthread_exit</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">retval</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">pthread_join</span><span class="p">(</span><span class="n">pthread_t</span> <span class="kr">thread</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">retval</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">pthread_detach</span><span class="p">(</span><span class="n">pthread_t</span> <span class="kr">thread</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">pthread_cancel</span><span class="p">(</span><span class="n">pthread_t</span> <span class="kr">thread</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹åˆ›å»ºcreate">çº¿ç¨‹åˆ›å»ºï¼ˆcreateï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    ä¸€èˆ¬æƒ…å†µä¸‹,mainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸»çº¿ç¨‹ï¼ˆmainçº¿ç¨‹ï¼‰ï¼Œå…¶ä½™åˆ›å»ºçš„çº¿ç¨‹
</span><span class="cm">    ç§°ä¹‹ä¸ºå­çº¿ç¨‹ã€‚
</span><span class="cm">    ç¨‹åºä¸­é»˜è®¤åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œfork()å‡½æ•°è°ƒç”¨ï¼Œ2è¿›è¡Œ
</span><span class="cm">    ç¨‹åºä¸­é»˜è®¤åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œpthread_create()å‡½æ•°è°ƒç”¨ï¼Œ2ä¸ªçº¿ç¨‹ã€‚
</span><span class="cm">
</span><span class="cm">    #include &lt;pthread.h&gt;
</span><span class="cm">    int pthread_create(pthread_t *thread, const pthread_attr_t *attr, 
</span><span class="cm">    void *(*start_routine) (void *), void *arg);
</span><span class="cm">
</span><span class="cm">        - åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="cm">        - å‚æ•°ï¼š
</span><span class="cm">            - threadï¼šä¼ å‡ºå‚æ•°ï¼Œçº¿ç¨‹åˆ›å»ºæˆåŠŸåï¼Œå­çº¿ç¨‹çš„çº¿ç¨‹IDè¢«å†™åˆ°è¯¥å˜é‡ä¸­ã€‚
</span><span class="cm">            - attr : è®¾ç½®çº¿ç¨‹çš„å±æ€§ï¼Œä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼ï¼ŒNULL
</span><span class="cm">            - start_routine : å‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å­çº¿ç¨‹éœ€è¦å¤„ç†çš„é€»è¾‘ä»£ç 
</span><span class="cm">            - arg : ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨ï¼Œä¼ å‚
</span><span class="cm">        - è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸï¼š0
</span><span class="cm">            å¤±è´¥ï¼šè¿”å›é”™è¯¯å·ã€‚è¿™ä¸ªé”™è¯¯å·å’Œä¹‹å‰errnoä¸å¤ªä¸€æ ·ã€‚
</span><span class="cm">            è·å–é”™è¯¯å·çš„ä¿¡æ¯ï¼š  char * strerror(int errnum);
</span><span class="cm">
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;child thread...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;arg value: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">num</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span> 
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// exit(0);
</span><span class="c1"></span><span class="p">}</span> 
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹ç»ˆæ­¢exit">çº¿ç¨‹ç»ˆæ­¢ï¼ˆexitï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">
</span><span class="cm">    #include &lt;pthread.h&gt;
</span><span class="cm">    void pthread_exit(void *retval);
</span><span class="cm">        åŠŸèƒ½ï¼šç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨å“ªä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ï¼Œå°±è¡¨ç¤ºç»ˆæ­¢å“ªä¸ªçº¿ç¨‹
</span><span class="cm">        å‚æ•°ï¼š
</span><span class="cm">            retval:éœ€è¦ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆï¼Œä½œä¸ºä¸€ä¸ªè¿”å›å€¼ï¼Œå¯ä»¥åœ¨pthread_join()ä¸­è·å–åˆ°ã€‚
</span><span class="cm">
</span><span class="cm">    pthread_t pthread_self(void);
</span><span class="cm">        åŠŸèƒ½ï¼šè·å–å½“å‰çš„çº¿ç¨‹çš„çº¿ç¨‹ID
</span><span class="cm">
</span><span class="cm">    int pthread_equal(pthread_t t1, pthread_t t2);
</span><span class="cm">        åŠŸèƒ½ï¼šæ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹IDæ˜¯å¦ç›¸ç­‰
</span><span class="cm">        ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œpthread_tç±»å‹çš„å®ç°ä¸ä¸€æ ·ï¼Œæœ‰çš„æ˜¯æ— ç¬¦å·çš„é•¿æ•´å‹ï¼Œæœ‰çš„
</span><span class="cm">        æ˜¯ä½¿ç”¨ç»“æ„ä½“å»å®ç°çš„ã€‚
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;child thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>    <span class="c1">// pthread_exit(NULL);
</span><span class="c1"></span><span class="p">}</span> 

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// ä¸»çº¿ç¨‹
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;tid : %ld, main thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tid</span> <span class="p">,</span><span class="n">pthread_self</span><span class="p">());</span>
    <span class="c1">// è®©ä¸»çº¿ç¨‹é€€å‡º,å½“ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œä¸ä¼šå½±å“å…¶ä»–æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ã€‚
</span><span class="c1"></span>    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;main thread exit</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// exit(0);
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹æ±‡åˆjoin">çº¿ç¨‹æ±‡åˆï¼ˆjoinï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;pthread.h&gt;
</span><span class="cm">    int pthread_join(pthread_t thread, void **retval);
</span><span class="cm">        - åŠŸèƒ½ï¼šå’Œä¸€ä¸ªå·²ç»ç»ˆæ­¢çš„çº¿ç¨‹è¿›è¡Œè¿æ¥
</span><span class="cm">                å›æ”¶å­çº¿ç¨‹çš„èµ„æº
</span><span class="cm">                è¿™ä¸ªå‡½æ•°æ˜¯é˜»å¡å‡½æ•°ï¼Œè°ƒç”¨ä¸€æ¬¡åªèƒ½å›æ”¶ä¸€ä¸ªå­çº¿ç¨‹
</span><span class="cm">                ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨
</span><span class="cm">        - å‚æ•°ï¼š
</span><span class="cm">            - threadï¼šéœ€è¦å›æ”¶çš„å­çº¿ç¨‹çš„ID
</span><span class="cm">            - retval: æ¥æ”¶å­çº¿ç¨‹é€€å‡ºæ—¶çš„è¿”å›å€¼
</span><span class="cm">        - è¿”å›å€¼ï¼š
</span><span class="cm">            0 : æˆåŠŸ
</span><span class="cm">            é0 : å¤±è´¥ï¼Œè¿”å›çš„é”™è¯¯å·
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;child thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
    <span class="c1">// sleep(3);
</span><span class="c1"></span>    <span class="c1">// return NULL; 
</span><span class="c1"></span>    <span class="c1">// int value = 10; // å±€éƒ¨å˜é‡
</span><span class="c1"></span>    <span class="n">pthread_exit</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>   <span class="c1">// return (void *)&amp;value;
</span><span class="c1"></span><span class="p">}</span> 

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ä¸»çº¿ç¨‹
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;tid : %ld, main thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tid</span> <span class="p">,</span><span class="n">pthread_self</span><span class="p">());</span>

    <span class="c1">// ä¸»çº¿ç¨‹è°ƒç”¨pthread_join()å›æ”¶å­çº¿ç¨‹çš„èµ„æº
</span><span class="c1"></span>    <span class="kt">int</span> <span class="o">*</span> <span class="n">thread_retval</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">thread_retval</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;exit data : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">thread_retval</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;å›æ”¶å­çº¿ç¨‹èµ„æºæˆåŠŸï¼</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="c1">// è®©ä¸»çº¿ç¨‹é€€å‡º,å½“ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œä¸ä¼šå½±å“å…¶ä»–æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ã€‚
</span><span class="c1"></span>    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹åˆ†ç¦»detach">çº¿ç¨‹åˆ†ç¦»ï¼ˆdetachï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;pthread.h&gt;
</span><span class="cm">    int pthread_detach(pthread_t thread);
</span><span class="cm">        - åŠŸèƒ½ï¼šåˆ†ç¦»ä¸€ä¸ªçº¿ç¨‹ã€‚è¢«åˆ†ç¦»çš„çº¿ç¨‹åœ¨ç»ˆæ­¢çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºè¿”å›ç»™ç³»ç»Ÿã€‚
</span><span class="cm">          1.ä¸èƒ½å¤šæ¬¡åˆ†ç¦»ï¼Œä¼šäº§ç”Ÿä¸å¯é¢„æ–™çš„è¡Œä¸ºã€‚
</span><span class="cm">          2.ä¸èƒ½å»è¿æ¥ä¸€ä¸ªå·²ç»åˆ†ç¦»çš„çº¿ç¨‹ï¼Œä¼šæŠ¥é”™ã€‚
</span><span class="cm">        - å‚æ•°ï¼šéœ€è¦åˆ†ç¦»çš„çº¿ç¨‹çš„ID
</span><span class="cm">        - è¿”å›å€¼ï¼š
</span><span class="cm">            æˆåŠŸï¼š0
</span><span class="cm">            å¤±è´¥ï¼šè¿”å›é”™è¯¯å·
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;chid thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error1 : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;tid : %ld, main thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>

    <span class="c1">// è®¾ç½®å­çº¿ç¨‹åˆ†ç¦»,å­çº¿ç¨‹åˆ†ç¦»åï¼Œå­çº¿ç¨‹ç»“æŸæ—¶å¯¹åº”çš„èµ„æºå°±ä¸éœ€è¦ä¸»çº¿ç¨‹é‡Šæ”¾
</span><span class="c1"></span>    <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_detach</span><span class="p">(</span><span class="n">tid</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error2 : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// è®¾ç½®åˆ†ç¦»åï¼Œå¯¹åˆ†ç¦»çš„å­çº¿ç¨‹è¿›è¡Œè¿æ¥ pthread_join()
</span><span class="c1"></span>    <span class="c1">// ret = pthread_join(tid, NULL);
</span><span class="c1"></span>    <span class="c1">// if(ret != 0) {
</span><span class="c1"></span>    <span class="c1">//     char * errstr = strerror(ret);
</span><span class="c1"></span>    <span class="c1">//     printf(&#34;error3 : %s\n&#34;, errstr);
</span><span class="c1"></span>    <span class="c1">// }
</span><span class="c1"></span>
    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹å–æ¶ˆcancel">çº¿ç¨‹å–æ¶ˆï¼ˆcancelï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    #include &lt;pthread.h&gt;
</span><span class="cm">    int pthread_cancel(pthread_t thread);
</span><span class="cm">        - åŠŸèƒ½ï¼šå–æ¶ˆçº¿ç¨‹ï¼ˆè®©çº¿ç¨‹ç»ˆæ­¢ï¼‰
</span><span class="cm">            å–æ¶ˆæŸä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç»ˆæ­¢æŸä¸ªçº¿ç¨‹çš„è¿è¡Œï¼Œ
</span><span class="cm">            ä½†æ˜¯å¹¶ä¸æ˜¯ç«‹é©¬ç»ˆæ­¢ï¼Œè€Œæ˜¯å½“å­çº¿ç¨‹æ‰§è¡Œåˆ°ä¸€ä¸ªå–æ¶ˆç‚¹ï¼Œçº¿ç¨‹æ‰ä¼šç»ˆæ­¢ã€‚
</span><span class="cm">            å–æ¶ˆç‚¹ï¼šç³»ç»Ÿè§„å®šå¥½çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„ç†è§£ä¸ºä»ç”¨æˆ·åŒºåˆ°å†…æ ¸åŒºçš„åˆ‡æ¢ï¼Œè¿™ä¸ªä½ç½®ç§°ä¹‹ä¸ºå–æ¶ˆç‚¹ã€‚
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;chid thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;child : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error1 : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// å–æ¶ˆçº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_cancel</span><span class="p">(</span><span class="n">tid</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;tid : %ld, main thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>


    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹å±æ€§attr">çº¿ç¨‹å±æ€§ï¼ˆattrï¼‰</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    int pthread_attr_init(pthread_attr_t *attr);
</span><span class="cm">        - åˆå§‹åŒ–çº¿ç¨‹å±æ€§å˜é‡
</span><span class="cm">
</span><span class="cm">    int pthread_attr_destroy(pthread_attr_t *attr);
</span><span class="cm">        - é‡Šæ”¾çº¿ç¨‹å±æ€§çš„èµ„æº
</span><span class="cm">
</span><span class="cm">    int pthread_attr_getdetachstate(const pthread_attr_t *attr, int *detachstate);
</span><span class="cm">        - è·å–çº¿ç¨‹åˆ†ç¦»çš„çŠ¶æ€å±æ€§
</span><span class="cm">
</span><span class="cm">    int pthread_attr_setdetachstate(pthread_attr_t *attr, int detachstate);
</span><span class="cm">        - è®¾ç½®çº¿ç¨‹åˆ†ç¦»çš„çŠ¶æ€å±æ€§
</span><span class="cm">*/</span>     

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="o">*</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;chid thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å±æ€§å˜é‡
</span><span class="c1"></span>    <span class="n">pthread_attr_t</span> <span class="n">attr</span><span class="p">;</span>
    <span class="c1">// åˆå§‹åŒ–å±æ€§å˜é‡
</span><span class="c1"></span>    <span class="n">pthread_attr_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span>

    <span class="c1">// è®¾ç½®å±æ€§
</span><span class="c1"></span>    <span class="n">pthread_attr_setdetachstate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">PTHREAD_CREATE_DETACHED</span><span class="p">);</span>

    <span class="c1">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">errstr</span> <span class="o">=</span> <span class="n">strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;error1 : %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">errstr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// è·å–çº¿ç¨‹çš„æ ˆçš„å¤§å°
</span><span class="c1"></span>    <span class="n">size_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="n">pthread_attr_getstacksize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;thread stack size : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

    <span class="c1">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id
</span><span class="c1"></span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;tid : %ld, main thread id : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>

    <span class="c1">// é‡Šæ”¾çº¿ç¨‹å±æ€§èµ„æº
</span><span class="c1"></span>    <span class="n">pthread_attr_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span>

    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="çº¿ç¨‹åŒæ­¥synchronization">çº¿ç¨‹åŒæ­¥ï¼ˆsynchronizationï¼‰</h2>
<p>â—¼ çº¿ç¨‹çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œèƒ½å¤Ÿé€šè¿‡å…¨å±€å˜é‡æ¥å…±äº«ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œè¿™ç§ä¾¿æ·çš„å…±äº«æ˜¯æœ‰ä»£ä»·çš„ï¼šå¿…é¡»ç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶ä¿®æ”¹åŒä¸€å˜é‡ï¼Œæˆ–è€…æŸä¸€çº¿ç¨‹ä¸ä¼šè¯»å–æ­£åœ¨ç”±å…¶ä»–çº¿ç¨‹ä¿®æ”¹çš„å˜é‡ã€‚</p>
<p>â—¼ <mark>ä¸´ç•ŒåŒº</mark>æ˜¯æŒ‡è®¿é—®æŸä¸€å…±äº«èµ„æºçš„ä»£ç ç‰‡æ®µï¼Œå¹¶ä¸”è¿™æ®µä»£ç çš„æ‰§è¡Œåº”ä¸ºåŸå­æ“ä½œï¼Œä¹Ÿå°±æ˜¯åŒæ—¶è®¿é—®åŒä¸€å…±äº«èµ„æºçš„å…¶ä»–çº¿ç¨‹ä¸åº”ç»ˆç«¯è¯¥ç‰‡æ®µçš„æ‰§è¡Œã€‚</p>
<p>â—¼ çº¿ç¨‹åŒæ­¥ï¼šå³å½“æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å¯¹å†…å­˜è¿›è¡Œæ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¸å¯ä»¥å¯¹è¿™ä¸ªå†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½å¯¹è¯¥å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆ™å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p>
<h3 id="äº’æ–¥é‡é”">äº’æ–¥é‡ï¼ˆé”ï¼‰</h3>
<h4 id="äº’æ–¥é‡åŸºæœ¬åŸç†">äº’æ–¥é‡åŸºæœ¬åŸç†</h4>
<p>ä¸ºé¿å…çº¿ç¨‹æ›´æ–°å…±äº«å˜é‡æ—¶å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨äº’æ–¥é‡ï¼ˆmutex æ˜¯ <strong>mutual exclusion</strong> çš„ç¼©å†™ï¼‰æ¥ç¡®ä¿åŒæ—¶ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æŸé¡¹å…±äº«èµ„æºã€‚å¯ä»¥ä½¿ç”¨äº’æ–¥é‡æ¥ä¿è¯å¯¹ä»»æ„å…±äº«èµ„æºçš„åŸå­è®¿é—®ã€‚</p>
<p>â—¼ äº’æ–¥é‡æœ‰ä¸¤ç§çŠ¶æ€ï¼šå·²é”å®šï¼ˆlockedï¼‰å’Œæœªé”å®šï¼ˆunlockedï¼‰ã€‚ä»»ä½•æ—¶å€™ï¼Œè‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é”å®šè¯¥äº’æ–¥é‡ã€‚è¯•å›¾å¯¹å·²ç»é”å®šçš„æŸä¸€äº’æ–¥é‡å†æ¬¡åŠ é”ï¼Œå°†å¯èƒ½é˜»å¡çº¿ç¨‹æˆ–è€…æŠ¥é”™å¤±è´¥ï¼Œå…·ä½“å–å†³äºåŠ é”æ—¶ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<p>â—¼ ä¸€æ—¦çº¿ç¨‹é”å®šäº’æ–¥é‡ï¼Œéšå³æˆä¸ºè¯¥äº’æ–¥é‡çš„æ‰€æœ‰è€…ï¼Œåªæœ‰æ‰€æœ‰è€…æ‰èƒ½ç»™äº’æ–¥é‡è§£é”ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹æ¯ä¸€å…±äº«èµ„æºï¼ˆå¯èƒ½ç”±å¤šä¸ªç›¸å…³å˜é‡ç»„æˆï¼‰ä¼šä½¿ç”¨<strong>ä¸åŒçš„äº’æ–¥é‡</strong>ï¼Œæ¯ä¸€çº¿ç¨‹åœ¨è®¿é—®åŒä¸€èµ„æºæ—¶å°†é‡‡ç”¨å¦‚ä¸‹åè®®ï¼š</p>
<ol>
<li>
<p>é’ˆå¯¹å…±äº«èµ„æºé”å®šäº’æ–¥é‡</p>
</li>
<li>
<p>è®¿é—®å…±äº«èµ„æº</p>
</li>
<li>
<p>å¯¹äº’æ–¥é‡è§£é”</p>
</li>
</ol>
<p>â—¼ å¦‚æœå¤šä¸ªçº¿ç¨‹è¯•å›¾æ‰§è¡Œè¿™ä¸€å—ä»£ç ï¼ˆä¸€ä¸ªä¸´ç•ŒåŒºï¼‰ï¼Œäº‹å®ä¸Šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæŒæœ‰è¯¥äº’æ–¥é‡ï¼ˆå…¶ä»–çº¿ç¨‹å°†é­åˆ°é˜»å¡ï¼‰ï¼Œå³åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥è¿™æ®µä»£ç åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img title="" src="https://i0.hdslb.com/bfs/album/7e02471c53c2b07e42322c73de653fa9c52b2746.png" alt="" data-align="center">
<h4 id="äº’æ–¥é‡ç¤ºä¾‹">äº’æ–¥é‡ç¤ºä¾‹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    äº’æ–¥é‡çš„ç±»å‹ pthread_mutex_t
</span><span class="cm">    int pthread_mutex_init(pthread_mutex_t *restrict mutex, const pthread_mutexattr_t *restrict attr);
</span><span class="cm">        - åˆå§‹åŒ–äº’æ–¥é‡
</span><span class="cm">        - å‚æ•° ï¼š
</span><span class="cm">            - mutex ï¼š éœ€è¦åˆå§‹åŒ–çš„äº’æ–¥é‡å˜é‡
</span><span class="cm">            - attr ï¼š äº’æ–¥é‡ç›¸å…³çš„å±æ€§ï¼ŒNULL
</span><span class="cm">        - restrict : Cè¯­è¨€çš„ä¿®é¥°ç¬¦ï¼Œè¢«ä¿®é¥°çš„æŒ‡é’ˆï¼Œä¸èƒ½ç”±å¦å¤–çš„ä¸€ä¸ªæŒ‡é’ˆè¿›è¡Œæ“ä½œã€‚
</span><span class="cm">            pthread_mutex_t *restrict mutex = xxx;
</span><span class="cm">            pthread_mutex_t * mutex1 = mutex;
</span><span class="cm">
</span><span class="cm">    int pthread_mutex_destroy(pthread_mutex_t *mutex);
</span><span class="cm">        - é‡Šæ”¾äº’æ–¥é‡çš„èµ„æº
</span><span class="cm">
</span><span class="cm">    int pthread_mutex_lock(pthread_mutex_t *mutex);
</span><span class="cm">        - åŠ é”ï¼Œé˜»å¡çš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹åŠ é”äº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åªèƒ½é˜»å¡ç­‰å¾…
</span><span class="cm">
</span><span class="cm">    int pthread_mutex_trylock(pthread_mutex_t *mutex);
</span><span class="cm">        - å°è¯•åŠ é”ï¼Œå¦‚æœåŠ é”å¤±è´¥ï¼Œä¸ä¼šé˜»å¡ï¼Œä¼šç›´æ¥è¿”å›ã€‚
</span><span class="cm">
</span><span class="cm">    int pthread_mutex_unlock(pthread_mutex_t *mutex);
</span><span class="cm">        - è§£é”
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// å…¨å±€å˜é‡ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å…±äº«è¿™ä¸€ä»½èµ„æºã€‚
</span><span class="c1"></span><span class="kt">int</span> <span class="n">tickets</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="c1">// åˆ›å»ºä¸€ä¸ªäº’æ–¥é‡
</span><span class="c1"></span><span class="n">pthread_mutex_t</span> <span class="n">mutex</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">sellticket</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// å–ç¥¨
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// åŠ é”
</span><span class="c1"></span>        <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">tickets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">usleep</span><span class="p">(</span><span class="mi">6000</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%ld æ­£åœ¨å–ç¬¬ %d å¼ é—¨ç¥¨</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">(),</span> <span class="n">tickets</span><span class="p">);</span>
            <span class="n">tickets</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
            <span class="c1">// è§£é”
</span><span class="c1"></span>            <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// è§£é”
</span><span class="c1"></span>        <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
    <span class="p">}</span>



    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆå§‹åŒ–äº’æ–¥é‡
</span><span class="c1"></span>    <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// åˆ›å»º3ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid1</span><span class="p">,</span> <span class="n">tid2</span><span class="p">,</span> <span class="n">tid3</span><span class="p">;</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">sellticket</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">sellticket</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">sellticket</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// å›æ”¶å­çº¿ç¨‹çš„èµ„æº,é˜»å¡
</span><span class="c1"></span>    <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// é€€å‡ºä¸»çº¿ç¨‹
</span><span class="c1"></span>
    <span class="c1">// é‡Šæ”¾äº’æ–¥é‡èµ„æº
</span><span class="c1"></span>    <span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="æ­»é”">æ­»é”</h3>
<p>â—¼ æœ‰æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è®¿é—®ä¸¤ä¸ªæˆ–æ›´å¤šä¸åŒçš„å…±äº«èµ„æºï¼Œè€Œæ¯ä¸ªèµ„æºåˆéƒ½ç”±ä¸åŒçš„äº’æ–¥é‡ç®¡ç†ã€‚å½“è¶…è¿‡ä¸€ä¸ªçº¿ç¨‹åŠ é”åŒä¸€ç»„äº’æ–¥é‡æ—¶ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿæ­»é”ã€‚</p>
<p>â—¼ ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºå…±äº«èµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”</p>
<h4 id="æ­»é”çš„å‡ ç§åœºæ™¯">æ­»é”çš„å‡ ç§åœºæ™¯</h4>
<ul>
<li>
<p>å¿˜è®°é‡Šæ”¾é”</p>
</li>
<li>
<p>é‡å¤åŠ é”</p>
</li>
<li>
<p>å¤šçº¿ç¨‹å¤šé”ï¼ŒæŠ¢å é”èµ„æº</p>
</li>
</ul>
<p>æ›´å¤šå…³äºæ­»é”çš„å†…å®¹å°†åœ¨æ“ä½œç³»ç»Ÿçš„ç›¸å…³ç†è®ºæ–‡ç« ä¸­ä»‹ç»ï¼Œæœ¬æ–‡ä¸å†ç»§ç»­è®¨è®ºã€‚</p>
<h4 id="æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶">æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶</h4>
<p>è™½ç„¶è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç”Ÿæ­»é”ï¼Œä½†æ­»é”çš„å‘ç”Ÿå¿…é¡»å…·å¤‡ä¸€å®šçš„æ¡ä»¶ï¼Œæ­»é”çš„å‘ç”Ÿå¿…é¡»å…·æœ‰ä»¥ä¸‹å››ä¸ªå¿…è¦æ¡ä»¶ã€‚</p>
<p>ï¼ˆ1ï¼‰<strong>äº’æ–¥æ¡ä»¶</strong>ï¼šæŒ‡è¿›ç¨‹å¯¹æ‰€åˆ†é…çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºåªç”±ä¸€ä¸ªè¿›ç¨‹å ç”¨ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶å®ƒè¿›ç¨‹è¯·æ±‚èµ„æºï¼Œåˆ™è¯·æ±‚è€…åªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰èµ„æºçš„è¿›ç¨‹ç”¨å®Œé‡Šæ”¾ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>è¯·æ±‚å’Œä¿æŒæ¡ä»¶</strong>ï¼šæŒ‡è¿›ç¨‹å·²ç»ä¿æŒè‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶å®ƒè¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±å·²è·å¾—çš„å…¶å®ƒèµ„æºä¿æŒä¸æ”¾ã€‚</p>
<p>ï¼ˆ3ï¼‰<strong>ä¸å‰¥å¤ºæ¡ä»¶</strong>ï¼šæŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨ä¹‹å‰ï¼Œä¸èƒ½è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶ç”±è‡ªå·±é‡Šæ”¾ã€‚</p>
<p>ï¼ˆ4ï¼‰<strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong>ï¼šæŒ‡åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶åœ¨ä¸€ä¸ªè¿›ç¨‹ &ndash; èµ„æºçš„ç¯å½¢é“¾ï¼Œå³è¿›ç¨‹é›†åˆ{P0ï¼Œ P1ï¼Œ P2 &hellip;ï¼Œ Pn} ä¸­çš„ P0 æ­£åœ¨ç­‰å¾…ä¸€ä¸ª P1 å ç”¨çš„èµ„æºï¼›P1 æ­£åœ¨ç­‰å¾… P2 å ç”¨çš„èµ„æºï¼Œ&hellip;.ï¼ŒPnæ­£åœ¨ç­‰å¾…å·²è¢« P0 å ç”¨çš„èµ„æºã€‚</p>
<h4 id="æ­»é”å¤„ç†æ–¹æ³•">æ­»é”å¤„ç†æ–¹æ³•</h4>
<p>åœ¨ç³»ç»Ÿä¸­å·²ç»å‡ºç°æ­»é”åï¼Œåº”è¯¥åŠæ—¶æ£€æµ‹åˆ°æ­»é”çš„å‘ç”Ÿï¼Œå¹¶é‡‡å–é€‚å½“çš„æªæ–½æ¥è§£é™¤æ­»é”</p>
<p>ï¼ˆ1ï¼‰<strong>é¢„é˜²æ­»é”</strong> ï¼šè¿™æ˜¯ä¸€ç§è¾ƒç®€å•å’Œç›´è§‚çš„äº‹å…ˆé¢„é˜²çš„æ–¹æ³•ã€‚æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½®æŸäº›é™åˆ¶æ¡ä»¶ï¼Œå»ç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªï¼Œæ¥é¢„é˜²å‘ç”Ÿæ­»é”ã€‚é¢„é˜²æ­»é”æ˜¯ä¸€ç§è¾ƒæ˜“å®ç°çš„æ–¹æ³•ï¼Œå·²è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½†æ˜¯ç”±äºæ‰€æ–½åŠ çš„é™åˆ¶æ¡ä»¶å¾€å¾€å¤ªä¸¥æ ¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡é™ä½ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>é¿å…æ­»é”</strong>ï¼šè¯¥æ–¹æ³•åŒæ ·æ˜¯å±äºäº‹å…ˆé¢„é˜²çš„ç­–ç•¥ï¼Œä½†å®ƒå¹¶ä¸é¡»äº‹å…ˆé‡‡å–å„ç§é™åˆ¶æªæ–½å»ç ´åäº§ç”Ÿæ­»é”çš„çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œè€Œæ˜¯åœ¨èµ„æºçš„åŠ¨æ€åˆ†é…è¿‡ç¨‹ä¸­ï¼Œç”¨æŸç§æ–¹æ³•å»é˜²æ­¢ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚</p>
<p>ï¼ˆ3ï¼‰<strong>æ£€æµ‹å’Œè§£é™¤æ­»é”</strong>ï¼šå…ˆæ£€æµ‹ï¼šè¿™ç§æ–¹æ³•å¹¶ä¸é¡»äº‹å…ˆé‡‡å–ä»»ä½•é™åˆ¶æ€§æªæ–½ï¼Œä¹Ÿä¸å¿…æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²ç»è¿›å…¥ä¸å®‰å…¨åŒºï¼Œæ­¤æ–¹æ³•å…è®¸ç³»ç»Ÿåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”ã€‚ä½†å¯é€šè¿‡ç³»ç»Ÿæ‰€è®¾ç½®çš„æ£€æµ‹æœºæ„ï¼ŒåŠæ—¶åœ°æ£€æµ‹å‡ºæ­»é”çš„å‘ç”Ÿï¼Œå¹¶ç²¾ç¡®åœ°ç¡®å®šä¸æ­»é”æœ‰å…³çš„è¿›ç¨‹å’Œèµ„æºã€‚æ£€æµ‹æ–¹æ³•åŒ…æ‹¬å®šæ—¶æ£€æµ‹ã€æ•ˆç‡ä½æ—¶æ£€æµ‹ã€è¿›ç¨‹ç­‰å¾…æ—¶æ£€æµ‹ç­‰ã€‚ç„¶åè§£é™¤æ­»é”ï¼šé‡‡å–é€‚å½“æªæ–½ï¼Œä»ç³»ç»Ÿä¸­å°†å·²å‘ç”Ÿçš„æ­»é”æ¸…é™¤æ‰ã€‚</p>
<p>è¿™æ˜¯ä¸æ£€æµ‹æ­»é”ç›¸é…å¥—çš„ä¸€ç§æªæ–½ã€‚å½“æ£€æµ‹åˆ°ç³»ç»Ÿä¸­å·²å‘ç”Ÿæ­»é”æ—¶ï¼Œé¡»å°†è¿›ç¨‹ä»æ­»é”çŠ¶æ€ä¸­è§£è„±å‡ºæ¥ã€‚å¸¸ç”¨çš„å®æ–½æ–¹æ³•æ˜¯æ’¤é”€æˆ–æŒ‚èµ·ä¸€äº›è¿›ç¨‹ï¼Œä»¥ä¾¿å›æ”¶ä¸€äº›èµ„æºï¼Œå†å°†è¿™äº›èµ„æºåˆ†é…ç»™å·²å¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹ï¼Œä½¿ä¹‹è½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œä»¥ç»§ç»­è¿è¡Œã€‚æ­»é”çš„æ£€æµ‹å’Œè§£é™¤æªæ–½ï¼Œæœ‰å¯èƒ½ä½¿ç³»ç»Ÿè·å¾—è¾ƒå¥½çš„èµ„æºåˆ©ç”¨ç‡å’Œååé‡ï¼Œä½†åœ¨å®ç°ä¸Šéš¾åº¦ä¹Ÿæœ€å¤§ã€‚</p>
<h4 id="æ­»é”ç¤ºä¾‹">æ­»é”ç¤ºä¾‹</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// åˆ›å»º2ä¸ªäº’æ–¥é‡
</span><span class="c1"></span><span class="n">pthread_mutex_t</span> <span class="n">mutex1</span><span class="p">,</span> <span class="n">mutex2</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">workA</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;workA....</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">);</span>
    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="o">*</span> <span class="nf">workB</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;workB....</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">);</span>
    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">);</span>

    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// åˆå§‹åŒ–äº’æ–¥é‡
</span><span class="c1"></span>    <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// åˆ›å»º2ä¸ªå­çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">tid1</span><span class="p">,</span> <span class="n">tid2</span><span class="p">;</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">workA</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">workB</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// å›æ”¶å­çº¿ç¨‹èµ„æº
</span><span class="c1"></span>    <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_join</span><span class="p">(</span><span class="n">tid2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// é‡Šæ”¾äº’æ–¥é‡èµ„æº
</span><span class="c1"></span>    <span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex1</span><span class="p">);</span>
    <span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex2</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="è¯»å†™é”">è¯»å†™é”</h3>
<p>å½“æœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº’æ–¥é”æ—¶ï¼Œäº’æ–¥é”å°†æ‰€æœ‰è¯•å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹éƒ½é˜»å¡ä½ã€‚ä½†æ˜¯è€ƒè™‘ä¸€ç§æƒ…å½¢ï¼Œå½“å‰æŒæœ‰äº’æ–¥é”çš„çº¿ç¨‹åªæ˜¯è¦è¯»è®¿é—®å…±äº«èµ„æºï¼Œè€ŒåŒæ—¶æœ‰å…¶å®ƒå‡ ä¸ªçº¿ç¨‹ä¹Ÿæƒ³è¯»å–è¿™ä¸ªå…±äº«èµ„æºï¼Œä½†æ˜¯ç”±äºäº’æ–¥é”çš„æ’å®ƒæ€§ï¼Œæ‰€æœ‰å…¶å®ƒçº¿ç¨‹éƒ½æ— æ³•è·å–é”ï¼Œä¹Ÿå°±æ— æ³•è¯»è®¿é—®å…±äº«èµ„æºäº†ï¼Œä½†æ˜¯å®é™…ä¸Šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»è®¿é—®å…±äº«èµ„æºå¹¶ä¸ä¼šå¯¼è‡´é—®é¢˜ã€‚</p>
<p>â—¼ åœ¨å¯¹æ•°æ®çš„è¯»å†™æ“ä½œä¸­ï¼Œæ›´å¤šçš„æ˜¯è¯»æ“ä½œï¼Œå†™æ“ä½œè¾ƒå°‘ï¼Œä¾‹å¦‚å¯¹æ•°æ®åº“æ•°æ®çš„è¯»å†™åº”ç”¨ã€‚ä¸ºäº†æ»¡è¶³å½“å‰èƒ½å¤Ÿå…è®¸å¤šä¸ªè¯»å‡ºï¼Œä½†åªå…è®¸ä¸€ä¸ªå†™å…¥çš„éœ€æ±‚ï¼Œçº¿ç¨‹æä¾›äº†è¯»å†™é”æ¥å®ç°ã€‚</p>
<p>â—¼ è¯»å†™é”çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹è¯»æ•°æ®ï¼Œåˆ™å…è®¸å…¶å®ƒçº¿ç¨‹æ‰§è¡Œè¯»æ“ä½œï¼Œä½†ä¸å…è®¸å†™æ“ä½œã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹å†™æ•°æ®ï¼Œåˆ™å…¶å®ƒçº¿ç¨‹éƒ½ä¸å…è®¸è¯»ã€å†™æ“ä½œã€‚</p>
</li>
<li>
<p>å†™æ˜¯ç‹¬å çš„ï¼Œå†™çš„<strong>ä¼˜å…ˆçº§é«˜</strong>ã€‚</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    è¯»å†™é”çš„ç±»å‹ pthread_rwlock_t
</span><span class="cm">    int pthread_rwlock_init(pthread_rwlock_t *restrict rwlock, const pthread_rwlockattr_t *restrict attr);
</span><span class="cm">    int pthread_rwlock_destroy(pthread_rwlock_t *rwlock);
</span><span class="cm">    int pthread_rwlock_rdlock(pthread_rwlock_t *rwlock);
</span><span class="cm">    int pthread_rwlock_tryrdlock(pthread_rwlock_t *rwlock);
</span><span class="cm">    int pthread_rwlock_wrlock(pthread_rwlock_t *rwlock);
</span><span class="cm">    int pthread_rwlock_trywrlock(pthread_rwlock_t *rwlock);
</span><span class="cm">    int pthread_rwlock_unlock(pthread_rwlock_t *rwlock);
</span><span class="cm">
</span><span class="cm">    æ¡ˆä¾‹ï¼š8ä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå…¨å±€å˜é‡ã€‚
</span><span class="cm">    3ä¸ªçº¿ç¨‹ä¸å®šæ—¶å†™è¿™ä¸ªå…¨å±€å˜é‡ï¼Œ5ä¸ªçº¿ç¨‹ä¸å®šæ—¶çš„è¯»è¿™ä¸ªå…¨å±€å˜é‡
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// åˆ›å»ºä¸€ä¸ªå…±äº«æ•°æ®
</span><span class="c1"></span><span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// pthread_mutex_t mutex;
</span><span class="c1"></span><span class="n">pthread_rwlock_t</span> <span class="n">rwlock</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">writeNum</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_rwlock_wrlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span>
        <span class="n">num</span><span class="o">++</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;++write, tid : %ld, num : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">(),</span> <span class="n">num</span><span class="p">);</span>
        <span class="n">pthread_rwlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span>
        <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">readNum</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_rwlock_rdlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;===read, tid : %ld, num : %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">(),</span> <span class="n">num</span><span class="p">);</span>
        <span class="n">pthread_rwlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span>
        <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

   <span class="n">pthread_rwlock_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// åˆ›å»º3ä¸ªå†™çº¿ç¨‹ï¼Œ5ä¸ªè¯»çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">wtids</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">rtids</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wtids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">writeNum</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">readNum</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// è®¾ç½®çº¿ç¨‹åˆ†ç¦»
</span><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">pthread_detach</span><span class="p">(</span><span class="n">wtids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">pthread_detach</span><span class="p">(</span><span class="n">rtids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="n">pthread_rwlock_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="æ¡ä»¶å˜é‡">æ¡ä»¶å˜é‡</h3>
<p>äº’æ–¥é”ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯å®ƒåªæœ‰ä¸¤ç§çŠ¶æ€ï¼šé”å®šå’Œéé”å®šã€‚è€Œæ¡ä»¶å˜é‡é€šè¿‡<strong>å…è®¸çº¿ç¨‹é˜»å¡å’Œç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å‘é€ä¿¡å·</strong>çš„æ–¹æ³•å¼¥è¡¥äº†äº’æ–¥é”çš„ä¸è¶³ï¼Œå®ƒå¸¸å’Œäº’æ–¥é”ä¸€èµ·é…åˆä½¿ç”¨ã€‚ä½¿ç”¨æ—¶ï¼Œæ¡ä»¶å˜é‡è¢«ç”¨æ¥é˜»å¡ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹å¾€å¾€è§£å¼€ç›¸åº”çš„äº’æ–¥é”å¹¶ç­‰å¾…æ¡ä»¶å‘ç”Ÿå˜åŒ–ã€‚ä¸€æ—¦å…¶ä»–çš„æŸä¸ªçº¿ç¨‹æ”¹å˜äº†æ¡ä»¶å˜é‡ï¼Œä»–å°†é€šçŸ¥ç›¸åº”çš„æ¡ä»¶å˜é‡å”¤é†’ä¸€ä¸ªæˆ–å¤šä¸ªæ­£è¢«æ­¤æ¡ä»¶å˜é‡é˜»å¡çš„çº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹å°†é‡æ–°é”å®šäº’æ–¥é”å¹¶é‡æ–°æµ‹è¯•æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œæ¡ä»¶å˜é‡è¢«ç”¨æ¥è¿›è¡Œ<strong>çº¿ç¨‹é—´çš„åŒæ­¥</strong>ã€‚</p>
<p><strong>æ¡ä»¶æœ¬èº«æ˜¯ç”±äº’æ–¥é‡ä¿æŠ¤çš„ã€‚çº¿ç¨‹åœ¨æ”¹å˜æ¡ä»¶çŠ¶æ€ä¹‹å‰å¿…é¡»é¦–å…ˆé”ä½äº’æ–¥é‡ã€‚</strong></p>
<p>ä¸¤ä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸´ç•ŒåŒºæ—¶ï¼Œé€šè¿‡äº’æ–¥é”ä¿æŠ¤ï¼Œè‹¥Açº¿ç¨‹å·²ç»åŠ é”ï¼ŒBçº¿ç¨‹å†åŠ é”æ—¶å€™ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°Aé‡Šæ”¾é”ï¼ŒBå†è·å¾—é”è¿è¡Œï¼Œè¿›ç¨‹Bå¿…é¡»ä¸åœçš„ä¸»åŠ¨è·å¾—é”ã€æ£€æŸ¥æ¡ä»¶ã€é‡Šæ”¾é”ã€å†è·å¾—é”ã€å†æ£€æŸ¥ã€å†é‡Šæ”¾ï¼Œä¸€ç›´åˆ°æ»¡è¶³è¿è¡Œçš„æ¡ä»¶çš„æ—¶å€™æ‰å¯ä»¥ï¼ˆè€Œæ­¤è¿‡ç¨‹ä¸­å…¶ä»–çº¿ç¨‹ä¸€ç›´åœ¨ç­‰å¾…è¯¥çº¿ç¨‹çš„ç»“æŸï¼‰ï¼Œè¿™ç§æ–¹å¼æ˜¯æ¯”è¾ƒæ¶ˆè€—ç³»ç»Ÿçš„èµ„æºçš„ã€‚è€Œæ¡ä»¶å˜é‡åŒæ ·æ˜¯é˜»å¡ï¼Œè¿˜éœ€è¦é€šçŸ¥æ‰èƒ½å”¤é†’ï¼Œçº¿ç¨‹è¢«å”¤é†’åï¼Œå®ƒå°†é‡æ–°æ£€æŸ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœè¿˜ä¸æ»¡è¶³ï¼Œè¯¥çº¿ç¨‹å°±ä¼‘çœ äº†ï¼Œåº”è¯¥ä»é˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…æ¡ä»¶æ»¡è¶³åè¢«å”¤é†’ï¼ŒèŠ‚çœäº†çº¿ç¨‹ä¸æ–­è¿è¡Œæµªè´¹çš„èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬ç”¨<code>while</code>è¯­å¥å®ç°ã€‚å½“çº¿ç¨‹Bå‘ç°è¢«é”å®šçš„å˜é‡ä¸æ»¡è¶³æ¡ä»¶æ—¶ä¼šè‡ªåŠ¨çš„é‡Šæ”¾é”å¹¶æŠŠè‡ªèº«ç½®äºç­‰å¾…çŠ¶æ€ï¼Œè®©å‡ºCPUçš„æ§åˆ¶æƒç»™å…¶å®ƒçº¿ç¨‹ã€‚å…¶å®ƒçº¿ç¨‹ æ­¤æ—¶å°±æœ‰æœºä¼šå»è¿›è¡Œæ“ä½œï¼Œå½“ä¿®æ”¹å®Œæˆåå†é€šçŸ¥é‚£äº›ç”±äºæ¡ä»¶ä¸æ»¡è¶³è€Œé™·å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚è¿™æ˜¯ä¸€ç§é€šçŸ¥æ¨¡å‹çš„åŒæ­¥æ–¹å¼ï¼Œå¤§å¤§çš„èŠ‚çœäº†CPUçš„è®¡ç®—èµ„æºï¼Œå‡å°‘äº†çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œè€Œä¸”æé«˜äº†çº¿ç¨‹ä¹‹é—´çš„ç³»ç»Ÿå·¥ä½œçš„æ•ˆç‡ã€‚è¿™ç§åŒæ­¥æ–¹å¼å°±æ˜¯æ¡ä»¶å˜é‡ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    æ¡ä»¶å˜é‡çš„ç±»å‹ pthread_cond_t
</span><span class="cm">    int pthread_cond_init(pthread_cond_t *restrict cond, const pthread_condattr_t *restrict attr);
</span><span class="cm">    int pthread_cond_destroy(pthread_cond_t *cond);
</span><span class="cm">    int pthread_cond_wait(pthread_cond_t *restrict cond, pthread_mutex_t *restrict mutex);
</span><span class="cm">        - ç­‰å¾…ï¼Œè°ƒç”¨äº†è¯¥å‡½æ•°ï¼Œçº¿ç¨‹ä¼šé˜»å¡ã€‚
</span><span class="cm">    int pthread_cond_timedwait(pthread_cond_t *restrict cond, pthread_mutex_t *restrict mutex, const struct timespec *restrict abstime);
</span><span class="cm">        - ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Œè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œçº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°æŒ‡å®šçš„æ—¶é—´ç»“æŸã€‚
</span><span class="cm">    int pthread_cond_signal(pthread_cond_t *cond);
</span><span class="cm">        - å”¤é†’ä¸€ä¸ªæˆ–è€…å¤šä¸ªç­‰å¾…çš„çº¿ç¨‹
</span><span class="cm">    int pthread_cond_broadcast(pthread_cond_t *cond);
</span><span class="cm">        - å”¤é†’æ‰€æœ‰çš„ç­‰å¾…çš„çº¿ç¨‹
</span><span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// åˆ›å»ºä¸€ä¸ªäº’æ–¥é‡
</span><span class="c1"></span><span class="n">pthread_mutex_t</span> <span class="n">mutex</span><span class="p">;</span>
<span class="c1">// åˆ›å»ºæ¡ä»¶å˜é‡
</span><span class="c1"></span><span class="n">pthread_cond_t</span> <span class="n">cond</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Node</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// å¤´ç»“ç‚¹
</span><span class="c1"></span><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// ä¸æ–­çš„åˆ›å»ºæ–°çš„èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°é“¾è¡¨ä¸­
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">newNode</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span><span class="p">));</span>
        <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">;</span>
        <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">num</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;add node, num : %d, tid : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>

        <span class="c1">// åªè¦ç”Ÿäº§äº†ä¸€ä¸ªï¼Œå°±é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹
</span><span class="c1"></span>        <span class="n">pthread_cond_signal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond</span><span class="p">);</span>

        <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">customer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="c1">// ä¿å­˜å¤´ç»“ç‚¹çš„æŒ‡é’ˆ
</span><span class="c1"></span>        <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="c1">// åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">head</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æœ‰æ•°æ®
</span><span class="c1"></span>            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;del node, num : %d, tid : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tmp</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
            <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
            <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
            <span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// æ²¡æœ‰æ•°æ®ï¼Œéœ€è¦ç­‰å¾…
</span><span class="c1"></span>            <span class="c1">// å½“è¿™ä¸ªå‡½æ•°è°ƒç”¨é˜»å¡çš„æ—¶å€™ï¼Œä¼šå¯¹äº’æ–¥é”è¿›è¡Œè§£é”ï¼Œå½“ä¸é˜»å¡çš„ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¼šé‡æ–°åŠ é”ã€‚
</span><span class="c1"></span>            <span class="n">pthread_cond_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
            <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span>  <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">pthread_cond_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">ptids</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ctids</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">customer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_detach</span><span class="p">(</span><span class="n">ptids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">pthread_detach</span><span class="p">(</span><span class="n">ctids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
    <span class="n">pthread_cond_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cond</span><span class="p">);</span>

    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="ä¿¡å·é‡">ä¿¡å·é‡</h3>
<p>ä¿¡å·é‡åˆç§°ä¸ºä¿¡å·ç¯ï¼ˆsemaphoreï¼‰ï¼Œå…¶ä¸è‡ªæ—‹é”ä¸åŒçš„åœ°æ–¹æ˜¯å®ƒå¯ä»¥å¼•èµ·è°ƒç”¨è€…ä¼‘çœ ï¼Œä¹Ÿå°±æ˜¯ä¿¡å·é‡æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç¡çœ é”ã€‚å¦‚æœæœ‰ä¸€ä¸ªä»»åŠ¡è¯•å›¾è·å¾—ä¸€ä¸ªä¸å¯ç”¨ï¼ˆå·²ç»è¢«å ç”¨ï¼‰çš„ä¿¡å·é‡æ—¶ï¼Œ<strong>ä¿¡å·é‡ä¼šå°†å…¶æ¨è¿›ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œç„¶åè®©å…¶ç¡çœ </strong>ã€‚è¿™æ—¶å¤„ç†å™¨èƒ½é‡è·è‡ªç”±ï¼Œä»è€Œå»æ‰§è¡Œå…¶ä»–ä»£ç ã€‚å½“æŒæœ‰çš„ä¿¡å·é‡å¯ç”¨ï¼ˆè¢«é‡Šæ”¾åï¼‰ï¼Œå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„é‚£ä¸ªä»»åŠ¡å°†è¢«å”¤é†’ï¼Œå¹¶å°†è·å¾—è¯¥ä¿¡å·é‡ã€‚ ä¿¡å·é‡ä¸€ä¸ªæœ‰ç”¨çš„ç‰¹æ€§æ˜¯å®ƒ<strong>å¯ä»¥åŒæ—¶å…è®¸ä»»æ„æ•°é‡çš„é”æŒæœ‰è€…</strong>ï¼Œè€Œè‡ªæ—‹é”å’Œäº’æ–¥é”åœ¨ä¸€ä¸ªæ—¶åˆ»æœ€å¤šå…è®¸ä¸€ä¸ªä»»åŠ¡æŒæœ‰å®ƒã€‚ä¿¡å·é‡åŒæ—¶å…è®¸çš„æŒæœ‰è€…æ•°é‡å¯ä»¥åœ¨å£°æ˜ä¿¡å·é‡æ—¶æŒ‡å®šã€‚è¿™ä¸ªå€¼ç§°ä¸ºä½¿ç”¨è€…æ•°é‡ï¼ˆusage countï¼‰æˆ–ç®€å•çš„å«åšæ•°é‡ï¼ˆcountï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¿¡å·é‡å’Œè‡ªæ—‹é”ä¸€æ ·ï¼Œåœ¨ä¸€ä¸ªæ—¶åˆ»ä»…å…è®¸æœ‰ä¸€ä¸ªé”æŒæœ‰è€…ã€‚è¿™æ—¶è®¡æ•°ç­‰äº1ï¼Œè¿™æ ·çš„ä¿¡å·é‡è¢«ç§°ä¸ºäºŒå€¼ä¿¡å·é‡æˆ–è€…ç§°ä¸ºäº’æ–¥ä¿¡å·é‡ã€‚å¦ä¸€æ–¹é¢ï¼Œåˆå§‹åŒ–æ—¶ä¹Ÿå¯ä»¥æŠŠæ•°é‡è®¾ç½®ä¸ºå¤§äº1çš„é0å€¼ã€‚è¿™ç§æƒ…å†µï¼Œä¿¡å·é‡è¢«ç§°ä¸ºè®¡æ•°ä¿¡å·é‡ï¼ˆcounting semaphoreï¼‰ï¼Œå®ƒå…è®¸åœ¨åŒä¸€æ—¶åˆ»è‡³å¤šæœ‰countä¸ªé”æŒæœ‰è€…ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm">    ä¿¡å·é‡çš„ç±»å‹ sem_t
</span><span class="cm">    int sem_init(sem_t *sem, int pshared, unsigned int value);
</span><span class="cm">        - åˆå§‹åŒ–ä¿¡å·é‡
</span><span class="cm">        - å‚æ•°ï¼š
</span><span class="cm">            - sem : ä¿¡å·é‡å˜é‡çš„åœ°å€
</span><span class="cm">            - pshared : 0 ç”¨åœ¨çº¿ç¨‹é—´ ï¼Œé0 ç”¨åœ¨è¿›ç¨‹é—´
</span><span class="cm">            - value : ä¿¡å·é‡ä¸­çš„å€¼
</span><span class="cm">
</span><span class="cm">    int sem_destroy(sem_t *sem);
</span><span class="cm">        - é‡Šæ”¾èµ„æº
</span><span class="cm">
</span><span class="cm">    int sem_wait(sem_t *sem);
</span><span class="cm">        - å¯¹ä¿¡å·é‡åŠ é”ï¼Œè°ƒç”¨ä¸€æ¬¡å¯¹ä¿¡å·é‡çš„å€¼-1ï¼Œå¦‚æœå€¼ä¸º0ï¼Œå°±é˜»å¡
</span><span class="cm">
</span><span class="cm">    int sem_trywait(sem_t *sem);
</span><span class="cm">
</span><span class="cm">    int sem_timedwait(sem_t *sem, const struct timespec *abs_timeout);
</span><span class="cm">    int sem_post(sem_t *sem);
</span><span class="cm">        - å¯¹ä¿¡å·é‡è§£é”ï¼Œè°ƒç”¨ä¸€æ¬¡å¯¹ä¿¡å·é‡çš„å€¼+1
</span><span class="cm">
</span><span class="cm">    int sem_getvalue(sem_t *sem, int *sval);
</span><span class="cm">
</span><span class="cm">    sem_t psem;
</span><span class="cm">    sem_t csem;
</span><span class="cm">    init(psem, 0, 8);
</span><span class="cm">    init(csem, 0, 0);
</span><span class="cm">
</span><span class="cm">    producer() {
</span><span class="cm">        sem_wait(&amp;psem);
</span><span class="cm">        sem_post(&amp;csem)
</span><span class="cm">    }
</span><span class="cm">
</span><span class="cm">    customer() {
</span><span class="cm">        sem_wait(&amp;csem);
</span><span class="cm">        sem_post(&amp;psem)
</span><span class="cm">    }
</span><span class="cm">
</span><span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;semaphore.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// åˆ›å»ºä¸€ä¸ªäº’æ–¥é‡
</span><span class="c1"></span><span class="n">pthread_mutex_t</span> <span class="n">mutex</span><span class="p">;</span>
<span class="c1">// åˆ›å»ºä¸¤ä¸ªä¿¡å·é‡
</span><span class="c1"></span><span class="n">sem_t</span> <span class="n">psem</span><span class="p">;</span>
<span class="n">sem_t</span> <span class="n">csem</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Node</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// å¤´ç»“ç‚¹
</span><span class="c1"></span><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">producer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// ä¸æ–­çš„åˆ›å»ºæ–°çš„èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°é“¾è¡¨ä¸­
</span><span class="c1"></span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">psem</span><span class="p">);</span>
        <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">newNode</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span><span class="p">));</span>
        <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">;</span>
        <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">num</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;add node, num : %d, tid : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
        <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csem</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span> <span class="nf">customer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csem</span><span class="p">);</span>
        <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="c1">// ä¿å­˜å¤´ç»“ç‚¹çš„æŒ‡é’ˆ
</span><span class="c1"></span>        <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;del node, num : %d, tid : %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tmp</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">,</span> <span class="n">pthread_self</span><span class="p">());</span>
        <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
        <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
        <span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">psem</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="k">return</span>  <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">psem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹
</span><span class="c1"></span>    <span class="n">pthread_t</span> <span class="n">ptids</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ctids</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">producer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">customer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pthread_detach</span><span class="p">(</span><span class="n">ptids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">pthread_detach</span><span class="p">(</span><span class="n">ctids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>

    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-04-12</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/linux_multi_threads/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://example.com/linux_multi_threads/" data-title="Linuxä¸‹çš„å¤šçº¿ç¨‹" data-hashtags="Unix,MultiThreads"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://example.com/linux_multi_threads/" data-title="Linuxä¸‹çš„å¤šçº¿ç¨‹" data-image="https://i0.hdslb.com/bfs/album/233aa1a553ddf86da52e30838d8b82e69bc4fdba.webp" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/unix/">Unix</a>,&nbsp;<a href="/tags/multithreads/">MultiThreads</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/ipc/" class="prev" rel="prev" title="Linuxå¤šè¿›ç¨‹é€šä¿¡"><i class="fas fa-angle-left fa-fw"></i>Linuxå¤šè¿›ç¨‹é€šä¿¡</a>
            <a href="/cmake_tutorial/" class="next" rel="next" title="CMakeä½¿ç”¨æ–¹æ³•">CMakeä½¿ç”¨æ–¹æ³•<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Weiyee</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":30},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
